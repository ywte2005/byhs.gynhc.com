# 商户互助平台 - 线上服务器测试指南

> 适用场景：通过FTP同步到线上服务器  
> 创建时间：2025-02-02

---

## 📋 测试环境说明

### 你的环境
- ✅ 线上服务器（远程）
- ✅ 通过FTP同步文件
- ✅ 无法直接运行命令行脚本

### 测试方案
- 🌐 通过浏览器访问测试页面
- 📱 使用Postman测试API接口
- 🔍 通过Web界面查看测试结果

---

## 🚀 快速开始

### 步骤1：上传测试文件

通过FTP上传以下文件到服务器根目录：

```
项目根目录/
├── test_database.php          # 数据库测试
├── create_test_users.php      # 创建测试用户
├── test_api.php               # API测试（命令行版）
├── test_web.php               # Web测试页面（新建）
├── backend/database/          # SQL文件目录
│   ├── 01_promo_tables.sql
│   ├── 02_merchant_tables.sql
│   ├── 03_task_tables.sql
│   ├── 04_wallet_tables.sql
│   ├── 05_config_tables.sql
│   └── 06_init_data.sql
```

### 步骤2：初始化数据库

**方法1：使用phpMyAdmin（推荐）**

1. 登录服务器的phpMyAdmin
2. 选择数据库 `fastadmin`
3. 点击 `导入` 标签
4. 按顺序导入SQL文件：
   - `01_promo_tables.sql`
   - `02_merchant_tables.sql`
   - `03_task_tables.sql`
   - `04_wallet_tables.sql`
   - `05_config_tables.sql`
   - `06_init_data.sql`

**方法2：使用SSH命令（如果有SSH权限）**

```bash
cd /path/to/project/backend/database
mysql -u 数据库用户名 -p 数据库名 < 01_promo_tables.sql
mysql -u 数据库用户名 -p 数据库名 < 02_merchant_tables.sql
mysql -u 数据库用户名 -p 数据库名 < 03_task_tables.sql
mysql -u 数据库用户名 -p 数据库名 < 04_wallet_tables.sql
mysql -u 数据库用户名 -p 数据库名 < 05_config_tables.sql
mysql -u 数据库用户名 -p 数据库名 < 06_init_data.sql
```

### 步骤3：访问Web测试页面

在浏览器中访问：
```
http://你的域名/test_web.php
```

这个页面会显示：
- ✅ 数据库连接状态
- ✅ 数据表检查结果
- ✅ 初始化数据统计
- ✅ 一键创建测试用户按钮
- ✅ API接口测试按钮

---

## 🌐 Web测试页面功能

### 1. 数据库检查
- 检查16张数据表是否存在
- 检查初始化数据是否完整
- 显示用户数量

### 2. 创建测试用户
- 点击按钮自动创建3个测试用户
- 显示用户账号、密码、Token
- 建立推广关系

### 3. API接口测试
- 测试所有35个API接口
- 实时显示测试进度
- 显示测试结果统计

---

## 📱 使用Postman测试

### 步骤1：导入Postman集合

1. 打开Postman
2. 点击 `Import`
3. 选择 `Postman集合.json` 文件
4. 导入成功

### 步骤2：配置环境变量

1. 创建新环境（Environment）
2. 添加变量：
   - `base_url`: `http://你的域名`
   - `token`: （稍后从测试页面获取）

### 步骤3：获取测试用户Token

1. 访问 `http://你的域名/test_web.php`
2. 点击"创建测试用户"按钮
3. 复制用户A的Token
4. 在Postman中设置 `token` 变量

### 步骤4：测试接口

1. 先测试登录接口
2. 按模块测试其他接口
3. 记录测试结果

---

## 🔧 配置说明

### 修改数据库配置

编辑 `application/database.php`：

```php
return [
    'type'            => 'mysql',
    'hostname'        => '数据库主机',  // 通常是 localhost
    'database'        => '数据库名',
    'username'        => '数据库用户名',
    'password'        => '数据库密码',
    'hostport'        => '3306',
    'charset'         => 'utf8mb4',
    'prefix'          => 'fa_',
];
```

### 修改前端API地址

编辑 `backend/cool-unix/.env`：

```
VITE_APP_API_URL=http://你的域名/api
```

---

## 📝 测试步骤详解

### 第一步：验证数据库

1. 访问：`http://你的域名/test_web.php`
2. 查看数据库检查结果
3. 确认16张表都存在
4. 确认初始化数据完整

**预期结果：**
```
✓ 数据库连接成功
✓ 16张数据表全部存在
✓ 等级配置: 6 条
✓ 分红配置: 4 条
✓ 奖励规则: 6 条
✓ 分润规则: 5 条
```

### 第二步：创建测试用户

1. 点击"创建测试用户"按钮
2. 等待创建完成
3. 记录用户信息（账号、密码、Token）

**预期结果：**
```
✓ 用户A创建成功
  账号: testuser_a / 13800000001
  密码: 123456
  Token: xxxxxx
  邀请码: TEST000001

✓ 用户B创建成功（用户A的下级）
✓ 用户C创建成功（用户B的下级）
```

### 第三步：测试API接口

**方法1：使用Web测试页面**
1. 点击"测试API接口"按钮
2. 等待测试完成
3. 查看测试结果

**方法2：使用Postman**
1. 配置环境变量（base_url、token）
2. 按模块测试接口
3. 记录测试结果

### 第四步：前端联调

1. 在HBuilderX中打开 `backend/cool-unix`
2. 修改 `.env` 文件中的API地址
3. 运行到浏览器
4. 使用测试账号登录
5. 测试各个页面功能

---

## 🧪 测试清单

### API接口测试（35个）

#### 认证模块
- [ ] POST /api/user/login - 用户登录
- [ ] POST /api/user/register - 用户注册

#### 商户模块
- [ ] GET /api/merchant/info - 获取商户信息
- [ ] POST /api/merchant/register - 商户注册
- [ ] GET /api/merchant/auditStatus - 获取审核状态
- [ ] POST /api/merchant/payEntryFee - 支付入驻费

#### 任务模块
- [ ] GET /api/task/list - 任务列表
- [ ] GET /api/task/detail - 任务详情
- [ ] POST /api/task/create - 发起任务
- [ ] POST /api/task/cancel - 取消任务
- [ ] GET /api/task/myTasks - 我的任务
- [ ] GET /api/task/subtaskAvailable - 可接任务
- [ ] GET /api/task/subtaskMy - 我接的任务
- [ ] GET /api/task/subtaskDetail - 子任务详情
- [ ] POST /api/task/subtaskAccept - 接受任务
- [ ] POST /api/task/subtaskUploadProof - 上传凭证
- [ ] GET /api/task/canReceive - 检查接单资格

#### 钱包模块
- [ ] GET /api/wallet/info - 钱包信息
- [ ] GET /api/wallet/logs - 流水记录
- [ ] POST /api/wallet/recharge - 充值
- [ ] POST /api/wallet/withdraw - 提现
- [ ] GET /api/wallet/withdrawRecords - 提现记录
- [ ] POST /api/wallet/depositPay - 充值保证金
- [ ] POST /api/wallet/depositWithdraw - 提取保证金

#### 推广模块
- [ ] GET /api/promo/overview - 推广概览
- [ ] GET /api/promo/levels - 等级列表
- [ ] POST /api/promo/purchaseLevel - 购买等级
- [ ] GET /api/promo/myInviteCode - 我的邀请码
- [ ] POST /api/promo/bindRelation - 绑定上级
- [ ] GET /api/promo/myTeam - 我的团队
- [ ] GET /api/promo/commissionList - 佣金记录
- [ ] GET /api/promo/walletLogs - 钱包流水
- [ ] GET /api/promo/performanceSummary - 业绩统计
- [ ] GET /api/promo/bonusSummary - 分红概览

### 前端页面测试（28个）

#### 认证模块
- [ ] 登录页面
- [ ] 注册页面
- [ ] 实名认证页面

#### 商户模块
- [ ] 商户入驻页面
- [ ] 审核状态页面
- [ ] 商户中心页面
- [ ] 商户信息页面

#### 任务模块
- [ ] 任务大厅
- [ ] 发起任务
- [ ] 任务详情
- [ ] 我的任务
- [ ] 保证金管理
- [ ] 可接任务列表
- [ ] 我接的任务
- [ ] 子任务详情
- [ ] 上传凭证

#### 钱包模块
- [ ] 钱包首页
- [ ] 充值页面
- [ ] 提现页面
- [ ] 账单明细

#### 推广模块
- [ ] 推广中心
- [ ] 等级体系
- [ ] 邀请好友
- [ ] 我的团队
- [ ] 佣金记录
- [ ] 业绩统计
- [ ] 分红记录
- [ ] 推广钱包

---

## 🐛 常见问题

### 1. 数据库连接失败

**问题：** 访问test_web.php显示数据库连接错误

**解决方案：**
1. 检查 `application/database.php` 配置
2. 确认数据库用户名、密码正确
3. 确认数据库已创建
4. 检查数据库服务是否启动

### 2. 无法访问测试页面

**问题：** 访问test_web.php显示404

**解决方案：**
1. 确认文件已通过FTP上传
2. 检查文件权限（644或755）
3. 确认URL路径正确
4. 检查Web服务器配置

### 3. SQL导入失败

**问题：** phpMyAdmin导入SQL文件报错

**解决方案：**
1. 检查SQL文件编码（UTF-8）
2. 分批导入（一次一个文件）
3. 检查数据库用户权限
4. 查看错误信息，针对性解决

### 4. 接口返回404

**问题：** Postman测试接口返回404

**解决方案：**
1. 检查URL是否正确
2. 确认路由配置正确
3. 检查 `.htaccess` 文件
4. 确认Web服务器支持URL重写

### 5. Token验证失败

**问题：** 接口返回"未登录"或"Token无效"

**解决方案：**
1. 确认Token已正确设置
2. 检查请求头格式：`Token: xxx`
3. 重新登录获取新Token
4. 检查Token是否过期

---

## 📊 测试记录

### 测试环境信息

| 项目 | 信息 |
|------|------|
| 服务器地址 | http://你的域名 |
| 数据库版本 | MySQL 5.7+ |
| PHP版本 | 7.4+ |
| 测试时间 | 2025-02-02 |

### 测试结果统计

| 模块 | 接口数 | 通过 | 失败 | 通过率 |
|------|--------|------|------|--------|
| 认证模块 | 2 | - | - | - |
| 商户模块 | 4 | - | - | - |
| 任务模块 | 11 | - | - | - |
| 钱包模块 | 8 | - | - | - |
| 推广模块 | 10 | - | - | - |
| **总计** | **35** | **-** | **-** | **-%** |

---

## 🎯 测试账号

| 用户 | 账号 | 密码 | 手机号 | Token |
|------|------|------|--------|-------|
| 用户A | testuser_a | 123456 | 13800000001 | 从测试页面获取 |
| 用户B | testuser_b | 123456 | 13800000002 | 从测试页面获取 |
| 用户C | testuser_c | 123456 | 13800000003 | 从测试页面获取 |

---

## 📝 下一步

### 测试完成后

1. **记录测试结果** - 填写测试报告
2. **修复问题** - 根据测试结果修复bug
3. **回归测试** - 重新测试修复的功能
4. **性能优化** - 优化慢接口
5. **准备上线** - 配置生产环境

### 预计时间

- 数据库初始化：30分钟
- API接口测试：2小时
- 前端联调测试：2-3天
- 问题修复：1天
- **总计：3-4天**

---

**文档创建时间：** 2025-02-02  
**适用场景：** 线上服务器 + FTP同步  
**下一步：** 上传测试文件，访问test_web.php开始测试
