# 商户互助平台 - 完整开发方案

> 版本: v1.0  
> 更新时间: 2025-01-22

---

## 一、项目概述

### 1.1 项目背景
商户互助刷单平台，实现商户之间互助完成刷单任务，配套完整的推广分销、等级权益、佣金分润体系。

### 1.2 核心业务流程

#### A. 商户入驻流程
```
注册 → 实名认证 → 提交商户资料 → 后台风控审核 → 缴纳入驻费 → 入驻成功
                                                    ↓
                              触发奖励：直推奖/间推奖/代理奖
```

#### B. 互助任务流程
```
商户A发起任务(设置目标金额、时间范围、支付通道)
        ↓
    缴纳保证金
        ↓
    后台审核通过
        ↓
系统智能拆分子任务(2000-5000元/笔，可配置)
        ↓
检查商户A保证金是否充足 → 不足则暂停派发
        ↓
    派发子任务给商户B
        ↓
从商户A保证金扣除该笔刷单金额(冻结)
        ↓
    商户B接单
        ↓
商户B线下完成支付 → 上传支付凭证
        ↓
系统查询第三方支付订单校验
        ↓
    校验通过，刷单完成
        ↓
商户B余额 += 刷单金额 + 佣金
        ↓
商户A冻结金额释放，扣除服务费
        ↓
    任务全部完成 → 剩余保证金可提现
```

#### C. 推广流程
```
注册 → 认证 → 购买等级 → 分享邀请码/二维码 → 下级产生收益 → 获取佣金/分润 → 月度分红结算
```

### 1.3 技术栈

| 层级 | 技术 | 版本 |
|------|------|------|
| **后端框架** | FastAdmin (ThinkPHP) | 5.x |
| **后端语言** | PHP | ≥7.4 |
| **数据库** | MySQL | ≥5.7 |
| **前端框架** | Cool Unix (uni-app x) | 8.1.0 |
| **前端语言** | TypeScript/UTS | - |
| **UI框架** | TailwindCSS + Cool UI | - |
| **支持平台** | H5 / App / 微信小程序 | - |

---

## 二、系统架构

### 2.1 后端目录结构
```
application/
├── api/                         # API模块(用户端接口)
│   ├── controller/
│   │   ├── Common.php          # 公共控制器基类
│   │   ├── User.php            # 用户相关(已有)
│   │   ├── Merchant.php        # 商户模块 [新增]
│   │   ├── Task.php            # 互助任务 [新增]
│   │   ├── Wallet.php          # 钱包模块 [新增]
│   │   ├── Promo.php           # 推广模块 [新增]
│   │   └── Settlement.php      # 结算模块 [新增]
│   └── library/
│       └── ... 
│
├── common/
│   ├── model/                   # 数据模型
│   │   ├── User.php            # 用户(已有)
│   │   ├── merchant/           # 商户模块 [新增]
│   │   │   ├── Merchant.php
│   │   │   └── MerchantAudit.php
│   │   ├── promo/              # 推广模块 [新增]
│   │   │   ├── Level.php
│   │   │   ├── Relation.php
│   │   │   ├── Commission.php
│   │   │   ├── Bonus.php
│   │   │   └── BonusConfig.php
│   │   ├── task/               # 任务模块 [新增]
│   │   │   ├── MutualTask.php
│   │   │   └── SubTask.php
│   │   ├── wallet/             # 钱包模块 [新增]
│   │   │   ├── Wallet.php
│   │   │   └── WalletLog.php
│   │   └── config/             # 配置模块 [新增]
│   │       ├── RewardRule.php
│   │       └── ProfitRule.php
│   │
│   └── library/                 # 业务服务层
│       ├── PromoService.php    # 推广服务 [新增]
│       ├── TaskService.php     # 任务服务 [新增]
│       ├── WalletService.php   # 钱包服务 [新增]
│       ├── RewardService.php   # 奖励服务 [新增]
│       └── SettlementService.php # 结算服务 [新增]
│
├── admin/                       # 后台管理模块
│   ├── controller/
│   │   ├── merchant/           # 商户管理 [新增]
│   │   │   ├── Merchant.php
│   │   │   └── Audit.php
│   │   ├── promo/              # 推广管理 [新增]
│   │   │   ├── Level.php
│   │   │   ├── Relation.php
│   │   │   ├── Commission.php
│   │   │   └── Bonus.php
│   │   ├── task/               # 任务管理 [新增]
│   │   │   ├── Mutualtask.php
│   │   │   └── Subtask.php
│   │   ├── wallet/             # 钱包管理 [新增]
│   │   │   ├── Wallet.php
│   │   │   └── Log.php
│   │   └── config/             # 配置管理 [新增]
│   │       ├── Reward.php
│   │       └── Profit.php
│   │
│   ├── model/                   # 后台模型
│   │   └── ...
│   │
│   └── view/                    # 后台视图
│       ├── merchant/
│       ├── promo/
│       ├── task/
│       ├── wallet/
│       └── config/
│
└── extra/
    └── queue.php               # 队列配置(用于异步任务)
```

### 2.2 前端目录结构
```
cool-unix/
├── pages/
│   ├── index/                   # 首页(已有)
│   ├── user/                    # 用户模块(已有)
│   ├── promo/                   # 推广模块(已有部分)
│   │   ├── index.uvue          # 推广中心
│   │   ├── level.uvue          # 等级购买
│   │   ├── invite.uvue         # 邀请分享
│   │   ├── team.uvue           # 我的团队
│   │   ├── commission.uvue     # 佣金记录
│   │   ├── performance.uvue    # 业绩统计
│   │   ├── bonus.uvue          # 分红
│   │   └── wallet.uvue         # 钱包
│   │
│   ├── merchant/                # 商户模块 [新增]
│   │   ├── index.uvue          # 商户中心
│   │   ├── register.uvue       # 商户注册/进件
│   │   ├── audit-status.uvue   # 审核状态
│   │   └── info.uvue           # 商户信息
│   │
│   ├── task/                    # 互助任务 [新增]
│   │   ├── index.uvue          # 任务列表
│   │   ├── create.uvue         # 发起任务
│   │   ├── detail.uvue         # 任务详情
│   │   ├── my-tasks.uvue       # 我发起的任务
│   │   ├── subtask/
│   │   │   ├── list.uvue       # 可接子任务列表
│   │   │   ├── my.uvue         # 我接的任务
│   │   │   ├── detail.uvue     # 子任务详情
│   │   │   └── upload.uvue     # 上传凭证
│   │   └── deposit.uvue        # 保证金管理
│   │
│   └── wallet/                  # 钱包模块 [新增]
│       ├── index.uvue          # 钱包首页
│       ├── recharge.uvue       # 充值
│       ├── withdraw.uvue       # 提现
│       └── logs.uvue           # 账单明细
│
├── services/                    # API服务层
│   ├── promo.ts                # 推广服务(已有)
│   ├── promo-task.ts           # (已有)
│   ├── merchant.ts             # 商户服务 [新增]
│   ├── task.ts                 # 任务服务 [新增]
│   └── wallet.ts               # 钱包服务 [新增]
│
└── types/                       # 类型定义 [新增]
    ├── merchant.ts
    ├── task.ts
    └── wallet.ts
```

---

## 三、数据库设计

### 3.1 表清单

| 序号 | 表名 | 说明 | 模块 |
|------|------|------|------|
| 1 | fa_promo_level | 等级配置表 | 推广 |
| 2 | fa_promo_relation | 用户推广关系表 | 推广 |
| 3 | fa_promo_commission | 佣金记录表 | 推广 |
| 4 | fa_promo_bonus_config | 分红配置表 | 推广 |
| 5 | fa_promo_bonus | 分红记录表 | 推广 |
| 6 | fa_promo_performance | 业绩统计表(月度) | 推广 |
| 7 | fa_merchant | 商户信息表 | 商户 |
| 8 | fa_merchant_audit | 商户审核记录表 | 商户 |
| 9 | fa_mutual_task | 互助主任务表 | 任务 |
| 10 | fa_sub_task | 子任务表 | 任务 |
| 11 | fa_wallet | 用户钱包表 | 钱包 |
| 12 | fa_wallet_log | 钱包流水表 | 钱包 |
| 13 | fa_reward_rule | 奖励规则配置表 | 配置 |
| 14 | fa_profit_rule | 分润规则配置表 | 配置 |
| 15 | fa_system_config | 系统配置表(扩展) | 配置 |

### 3.2 核心表结构

#### 3.2.1 等级配置表 (fa_promo_level)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| name | varchar(50) | 等级名称 |
| sort | int | 排序(数字越小等级越低) |
| upgrade_type | enum | 升级方式:purchase/performance/both |
| upgrade_price | decimal(10,2) | 购买价格 |
| personal_performance_min | decimal(15,2) | 个人业绩要求 |
| team_performance_min | decimal(15,2) | 团队业绩要求 |
| direct_invite_min | int | 直推人数要求 |
| commission_rate | decimal(5,4) | 刷单佣金比例 |
| status | enum | 状态:normal/hidden |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

#### 3.2.2 用户推广关系表 (fa_promo_relation)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| user_id | int | 用户ID(唯一) |
| level_id | int | 当前等级ID |
| parent_id | int | 直接上级用户ID |
| path | varchar(1000) | 完整上级路径,如:1,5,10 |
| depth | int | 层级深度 |
| invite_code | varchar(20) | 邀请码(唯一) |
| createtime | int | 创建时间 |

#### 3.2.3 钱包表 (fa_wallet)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| user_id | int | 用户ID(唯一) |
| balance | decimal(15,2) | 可用余额 |
| deposit | decimal(15,2) | 保证金 |
| frozen | decimal(15,2) | 冻结金额(已派发待完成) |
| mutual_balance | decimal(15,2) | 互助余额 |
| total_income | decimal(15,2) | 累计收入 |
| total_withdraw | decimal(15,2) | 累计提现 |
| updatetime | int | 更新时间 |

#### 3.2.4 钱包流水表 (fa_wallet_log)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | bigint | 主键 |
| user_id | int | 用户ID |
| wallet_type | enum | 钱包类型:balance/deposit/frozen/mutual |
| change_type | enum | 变动类型:income/expense/freeze/unfreeze |
| amount | decimal(15,2) | 变动金额 |
| before_amount | decimal(15,2) | 变动前金额 |
| after_amount | decimal(15,2) | 变动后金额 |
| biz_type | varchar(50) | 业务类型 |
| biz_id | int | 业务ID |
| remark | varchar(255) | 备注 |
| createtime | int | 创建时间 |

#### 3.2.5 互助主任务表 (fa_mutual_task)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| user_id | int | 发起用户ID |
| task_no | varchar(32) | 任务编号 |
| total_amount | decimal(15,2) | 目标总金额 |
| completed_amount | decimal(15,2) | 已完成金额 |
| deposit_amount | decimal(15,2) | 缴纳保证金 |
| service_fee_rate | decimal(5,4) | 服务费率 |
| sub_task_min | decimal(10,2) | 子任务最小金额 |
| sub_task_max | decimal(10,2) | 子任务最大金额 |
| channel_id | int | 支付通道ID |
| start_time | int | 开始时间 |
| end_time | int | 结束时间 |
| status | enum | 状态:pending/approved/running/paused/completed/cancelled |
| remark | varchar(255) | 备注 |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

#### 3.2.6 子任务表 (fa_sub_task)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | bigint | 主键 |
| task_id | int | 主任务ID |
| task_no | varchar(32) | 子任务编号 |
| from_user_id | int | 发起方用户ID |
| to_user_id | int | 执行方用户ID |
| amount | decimal(10,2) | 刷单金额 |
| commission | decimal(10,2) | 佣金 |
| service_fee | decimal(10,2) | 服务费 |
| proof_image | varchar(500) | 支付凭证图片 |
| third_order_no | varchar(64) | 第三方订单号 |
| status | enum | 状态:pending/assigned/accepted/paid/verified/completed/failed/cancelled |
| assigned_time | int | 派发时间 |
| accepted_time | int | 接单时间 |
| paid_time | int | 支付时间 |
| completed_time | int | 完成时间 |
| fail_reason | varchar(255) | 失败原因 |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

#### 3.2.7 商户信息表 (fa_merchant)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| user_id | int | 用户ID(唯一) |
| merchant_no | varchar(32) | 商户编号 |
| name | varchar(100) | 商户名称 |
| legal_name | varchar(50) | 法人姓名 |
| id_card | varchar(20) | 身份证号 |
| id_card_front | varchar(255) | 身份证正面 |
| id_card_back | varchar(255) | 身份证反面 |
| business_license | varchar(255) | 营业执照 |
| bank_name | varchar(100) | 开户银行 |
| bank_account | varchar(30) | 银行账号 |
| bank_branch | varchar(200) | 开户支行 |
| contact_phone | varchar(20) | 联系电话 |
| entry_fee | decimal(10,2) | 入驻费 |
| status | enum | 状态:pending/approved/rejected/disabled |
| approved_time | int | 审核通过时间 |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

#### 3.2.8 奖励规则配置表 (fa_reward_rule)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| name | varchar(50) | 规则名称 |
| scene | enum | 触发场景:merchant_entry/order_complete/level_upgrade |
| reward_type | enum | 奖励类型:direct/indirect/level_diff/peer/team |
| target_depth | int | 目标层级(0=全部,-1=不限) |
| level_require | varchar(100) | 等级要求(JSON) |
| amount_type | enum | 金额类型:fixed/percent |
| amount_value | decimal(10,4) | 金额值 |
| growth_min | decimal(15,2) | 增量门槛 |
| status | enum | 状态:normal/hidden |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

#### 3.2.9 分红配置表 (fa_promo_bonus_config)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| name | varchar(50) | 档位名称 |
| team_performance_min | decimal(15,2) | 团队业绩门槛 |
| personal_performance_min | decimal(15,2) | 个人业绩门槛 |
| qualified_count_min | int | 达标人数门槛 |
| growth_min | decimal(15,2) | 增量门槛 |
| pool_rate | decimal(5,4) | 奖池比例 |
| sort | int | 排序 |
| status | enum | 状态:normal/hidden |
| createtime | int | 创建时间 |

#### 3.2.10 佣金记录表 (fa_promo_commission)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | bigint | 主键 |
| user_id | int | 获得者用户ID |
| source_user_id | int | 来源用户ID |
| scene | varchar(50) | 触发场景 |
| reward_type | varchar(50) | 奖励类型 |
| rule_id | int | 规则ID |
| base_amount | decimal(15,2) | 计算基数 |
| amount | decimal(15,2) | 佣金金额 |
| status | enum | 状态:pending/settled/cancelled |
| settle_time | int | 结算时间 |
| remark | varchar(255) | 备注 |
| createtime | int | 创建时间 |

---

## 四、核心业务逻辑

### 4.1 互助余额机制

**公式：**
```
互助余额 = 初始值(0) + 帮别人刷的总额 - 被别人刷的总额
```

**规则：**
- 互助余额 < -50,000 → 暂停新任务派发
- 互助余额 ≥ -20,000 → 自动恢复派发
- 核心原则：先刷别人，才能被别人刷

### 4.2 子任务派发逻辑

```
1. 检查主任务状态 = running
2. 检查发起方保证金 >= 待派发子任务金额
3. 查找可接单商户(互助余额满足条件)
4. 从发起方保证金扣除金额 → 转入冻结
5. 创建子任务，状态 = assigned
6. 通知执行方
```

### 4.3 刷单完成逻辑

```
1. 执行方上传支付凭证
2. 系统校验第三方支付订单
3. 校验通过：
   - 执行方余额 += 刷单金额 + 佣金
   - 执行方互助余额 += 刷单金额
   - 发起方冻结 -= 刷单金额
   - 发起方互助余额 -= 刷单金额
   - 扣除服务费
   - 触发分润/奖励计算
4. 校验失败：
   - 子任务状态 = failed
   - 发起方冻结 → 退回保证金
```

### 4.4 奖励触发机制

| 场景 | 触发条件 | 奖励类型 |
|------|----------|----------|
| 商户入驻 | 审核通过并缴纳入驻费 | 直推奖、间推奖、代理奖 |
| 刷单完成 | 子任务状态=completed | 等级差分润 |
| 购买等级 | 支付成功 | 直推奖、间推奖 |

### 4.5 等级差分润

```
1. 刷单完成时触发
2. 沿推广关系链向上遍历
3. 计算当前用户与上级的等级差
4. 匹配分润档位规则
5. 检查增量条件(月度业绩增量)
6. 满足条件则发放分润
```

### 4.6 月度分红

```
每月1号执行：
1. 统计上月平台总刷单金额
2. 计算各档位奖池 = 总额 × 档位比例
3. 统计各档位达标用户数
4. 奖金 = 奖池 / 达标人数
5. 生成分红记录
6. 3号前完成发放
```

---

## 五、API 接口设计

### 5.1 接口规范

**统一返回格式：**
```json
{
  "code": 0,
  "message": "操作成功",
  "data": {}
}
```

**状态码：**
| code | 说明 |
|------|------|
| 0 | 成功 |
| 1001 | 参数缺失 |
| 1002 | 参数格式错误 |
| 2001 | 未登录 |
| 2002 | 无权限 |
| 3001 | 当前状态不允许该操作 |
| 3002 | 余额不足 |
| 3003 | 保证金不足 |
| 5001 | 系统异常 |

### 5.2 接口清单

#### A. 商户模块 `/api/merchant`
| 接口 | 方法 | 说明 |
|------|------|------|
| /info | GET | 获取商户信息 |
| /register | POST | 商户注册/进件 |
| /auditStatus | GET | 获取审核状态 |
| /payEntryFee | POST | 支付入驻费 |

#### B. 任务模块 `/api/task`
| 接口 | 方法 | 说明 |
|------|------|------|
| /list | GET | 任务列表 |
| /detail | GET | 任务详情 |
| /create | POST | 发起任务 |
| /cancel | POST | 取消任务 |
| /myTasks | GET | 我发起的任务 |
| /subtask/available | GET | 可接子任务列表 |
| /subtask/my | GET | 我接的子任务 |
| /subtask/detail | GET | 子任务详情 |
| /subtask/accept | POST | 接受子任务 |
| /subtask/uploadProof | POST | 上传支付凭证 |
| /subtask/cancel | POST | 取消接单 |

#### C. 钱包模块 `/api/wallet`
| 接口 | 方法 | 说明 |
|------|------|------|
| /info | GET | 钱包信息 |
| /logs | GET | 流水记录 |
| /recharge | POST | 充值 |
| /withdraw | POST | 提现申请 |
| /withdrawRecords | GET | 提现记录 |
| /deposit/pay | POST | 缴纳保证金 |
| /deposit/withdraw | POST | 提取保证金 |

#### D. 推广模块 `/api/promo`
| 接口 | 方法 | 说明 |
|------|------|------|
| /overview | GET | 推广概览 |
| /levels | GET | 等级列表 |
| /purchaseLevel | POST | 购买等级 |
| /myInviteCode | GET | 我的邀请码 |
| /bindRelation | POST | 绑定上级 |
| /myTeam | GET | 我的团队 |
| /commissionList | GET | 佣金记录 |
| /walletLogs | GET | 钱包流水 |
| /performanceSummary | GET | 业绩统计 |
| /bonusSummary | GET | 分红概览 |
| /bonusRecords | GET | 分红记录 |

---

## 六、后台管理功能

### 6.1 功能模块

| 模块 | 功能 |
|------|------|
| **商户管理** | 商户列表、审核管理、商户详情 |
| **任务管理** | 主任务列表、子任务列表、任务审核 |
| **钱包管理** | 用户钱包、流水查询、提现审核 |
| **推广管理** | 等级配置、关系查询、佣金记录、分红管理 |
| **配置管理** | 奖励规则、分润规则、分红配置、系统参数 |
| **数据统计** | 交易统计、业绩报表、分红报表 |

### 6.2 后台菜单结构

```
├── 商户管理
│   ├── 商户列表
│   └── 审核管理
├── 任务管理
│   ├── 主任务列表
│   └── 子任务列表
├── 钱包管理
│   ├── 用户钱包
│   ├── 流水查询
│   └── 提现审核
├── 推广管理
│   ├── 等级配置
│   ├── 推广关系
│   ├── 佣金记录
│   └── 分红管理
├── 配置中心
│   ├── 奖励规则
│   ├── 分润规则
│   ├── 分红配置
│   └── 系统参数
└── 数据统计
    ├── 交易统计
    └── 业绩报表
```

---

## 6.5 支付集成

### 6.5.1 支付方式
本系统**仅使用微信支付**作为在线支付方式，基于 FastAdmin 的 **epay 插件**实现。

### 6.5.2 epay 插件
- **插件路径**: `addons/epay`
- **核心类**: `addons\epay\library\Service`
- **SDK版本**: 支持 V2/V3 接口
- **配置位置**: 后台 → 插件管理 → 微信支付宝整合

### 6.5.3 支付场景

| 场景 | 说明 | 支付方式 |
|------|------|----------|
| 余额充值 | 用户充值到钱包余额 | 微信支付 |
| 购买等级 | 购买推广等级 | 微信支付 |
| 商户入驻费 | 缴纳商户入驻费用 | 微信支付 |

### 6.5.4 充值流程

```
用户选择充值金额 → 创建充值订单(fa_recharge)
        ↓
调用 epay 插件发起微信支付
        ↓
用户完成支付 → 微信回调通知
        ↓
验证签名 → 更新订单状态为 paid
        ↓
增加用户余额 → 记录流水
```

### 6.5.5 后端实现

```php
// 发起微信支付
use addons\epay\library\Service;

$params = [
    'amount'    => $amount,           // 支付金额
    'orderid'   => $orderNo,          // 订单号
    'type'      => 'wechat',          // 支付类型：微信
    'title'     => '余额充值',         // 订单标题
    'notifyurl' => url('api/payment/notify', [], true, true),  // 回调地址
    'returnurl' => url('api/payment/return', [], true, true),  // 跳转地址
    'method'    => 'mp',              // 支付方式：mp(小程序)/app/scan/wap
];

$result = Service::submitOrder($params);
```

### 6.5.6 支付方式(method)

| method | 说明 | 适用场景 |
|--------|------|----------|
| mp | 小程序支付 | 微信小程序 |
| app | APP支付 | 原生APP |
| scan | 扫码支付 | PC网页 |
| wap | H5支付 | 手机浏览器 |
| miniapp | 小程序支付 | 同mp |

### 6.5.7 回调处理

```php
// 支付回调处理
public function notify()
{
    $paytype = $this->request->param('paytype', 'wechat');
    $pay = Service::checkNotify($paytype);
    
    if (!$pay) {
        return 'fail';
    }
    
    $data = $pay->verify();
    $orderNo = $data['out_trade_no'];
    
    // 处理业务逻辑
    $recharge = Recharge::where('order_no', $orderNo)->find();
    if ($recharge && $recharge->status === 'pending') {
        $recharge->status = 'paid';
        $recharge->paid_time = time();
        $recharge->trade_no = $data['transaction_id'];
        $recharge->save();
        
        // 增加用户余额
        WalletService::changeBalance($recharge->user_id, $recharge->amount, 'recharge', $recharge->id, '充值到账');
    }
    
    return $pay->success();
}
```

### 6.5.8 充值订单表 (fa_recharge) [已存在]

> 该表已存在于数据库中，以下为字段说明供参考。

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 主键 |
| user_id | int | 用户ID |
| order_no | varchar(32) | 订单号 |
| amount | decimal(10,2) | 充值金额 |
| target | enum | 充值目标：balance/deposit |
| pay_method | varchar(20) | 支付方式 |
| trade_no | varchar(64) | 第三方交易号 |
| status | enum | 状态：pending/paid/failed |
| paid_time | int | 支付时间 |
| createtime | int | 创建时间 |
| updatetime | int | 更新时间 |

### 6.5.9 后台充值管理

| 功能 | 说明 |
|------|------|
| 订单列表 | 查看所有充值订单，支持按状态筛选 |
| 手动确认 | 用户转账后，管理员确认到账（补单） |
| 批量确认 | 批量处理多个订单 |
| 退款 | 取消订单或退款处理 |

---

## 七、前端开发规范

### 7.1 UTS 规范
- 强类型，所有变量必须声明类型
- 先定义后使用
- 不使用 `undefined`，使用 `null`
- 用 `type` 定义对象类型，不用 `interface`
- 可空类型使用 `| null` 或 `?`

### 7.2 UVUE 规范
- 仅使用 Vue3 组合式 API
- 不使用 Pinia/Vuex
- 组件使用 easycom 规范
- 页面参数通过 props 接收

### 7.3 样式规范
- 仅使用 flex 布局
- 文字样式只能加在 `<text>` 上
- 单位仅使用 px/rpx/%
- 使用 TailwindCSS 类名

### 7.4 组件规范
- 页面使用 `<cl-page>` 包裹
- 底部操作区使用 `<cl-footer>`
- 参考 `/pages/demo` 示例
- 参考 `/pages/template` 模板

---

## 八、安全设计

### 8.1 接口安全
- 所有接口需 Token 校验
- 敏感操作需二次验证
- 请求频率限制

### 8.2 资金安全
- 金额使用 decimal 类型
- 所有资金操作记录流水
- 关键操作使用数据库事务
- 防并发：乐观锁/悲观锁

### 8.3 数据安全
- 敏感信息脱敏存储
- 日志不记录敏感数据
- 操作审计追踪

---

## 九、部署相关

### 9.1 环境要求
- PHP ≥ 7.4
- MySQL ≥ 5.7
- Redis (用于队列)
- Node.js (用于前端构建)

### 9.2 定时任务
```bash
# 月度分红计算(每月1号凌晨执行)
0 0 1 * * php /path/to/think bonus:calculate

# 子任务超时检查(每5分钟)
*/5 * * * * php /path/to/think task:checkTimeout

# 业绩统计快照(每天凌晨)
0 0 * * * php /path/to/think performance:snapshot
```

---

## 十、版本规划

| 版本 | 功能 | 预计 |
|------|------|------|
| v1.0 | 基础功能：商户入驻、互助任务、钱包、推广 | - |
| v1.1 | 完善：数据统计、风控规则 | - |
| v1.2 | 优化：性能优化、体验优化 | - |
