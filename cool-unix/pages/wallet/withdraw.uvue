<template>
	<view class="page-container">
		<!-- é¡¶éƒ¨å¯¼èˆª -->
		<view class="header">
			<view class="header-left" @click="goBack">
				<uni-icons type="left" size="24" color="#1f2329"></uni-icons>
				<text class="header-title">æç°</text>
			</view>
		</view>

		<!-- å†…å®¹åŒºåŸŸ -->
		<scroll-view class="content" scroll-y>
			<view class="content-wrapper">
				<!-- å¯æç°ä½™é¢ -->
				<view class="card balance-card">
					<text class="card-label">å¯æç°ä½™é¢ï¼ˆå…ƒï¼‰</text>
					<text class="balance-value">{{ availableBalance }}</text>
				</view>

				<!-- æç°é‡‘é¢ -->
				<view class="card amount-card">
					<text class="card-title">æç°é‡‘é¢</text>
					
					<view class="amount-input-box">
						<text class="currency-symbol">Â¥</text>
						<input 
							v-model="withdrawAmount"
							type="digit"
							class="amount-input"
							placeholder="è¯·è¾“å…¥æç°é‡‘é¢"
							placeholder-class="input-placeholder"
							:focus="true"
						/>
					</view>

					<view class="amount-footer">
						<text class="fee-text">æ‰‹ç»­è´¹ï¼š{{ serviceFee }}å…ƒ</text>
						<view @click="withdrawAll">
							<text class="action-text">å…¨éƒ¨æç°</text>
						</view>
					</view>
				</view>

				<!-- æç°è´¦æˆ· -->
				<view class="card account-card">
					<text class="card-title">æç°è´¦æˆ·</text>
					
					<view 
						v-for="(item, index) in bankCards" 
						:key="index"
						@click="selectBankCard(item.id)"
						class="account-item"
					>
						<view class="account-info">
							<view class="bank-icon-box">
								<uni-icons type="home" size="20" color="#0052d9"></uni-icons>
							</view>
							<view class="bank-detail">
								<text class="bank-name">{{ item.bankName }}</text>
								<text class="bank-no">{{ item.cardNo }}</text>
							</view>
						</view>
						<view class="radio-box" :class="{ active: selectedBankCard === item.id }">
							<view v-if="selectedBankCard === item.id" class="radio-inner"></view>
						</view>
					</view>

					<view @click="addBankCard" class="add-card-btn">
						<text class="add-card-text">+ æ·»åŠ é“¶è¡Œå¡</text>
					</view>
				</view>

				<!-- åˆ°è´¦æ—¶é—´ -->
				<view class="card time-card">
					<text class="card-title">åˆ°è´¦æ—¶é—´</text>
					
					<view class="time-item">
						<view class="time-info">
							<uni-icons type="bolt" size="20" color="#faad14"></uni-icons>
							<view class="time-detail">
								<text class="time-title">å®æ—¶åˆ°è´¦</text>
								<text class="time-desc">é¢„è®¡2å°æ—¶å†…åˆ°è´¦</text>
							</view>
						</view>
						<text class="fee-highlight">æ‰‹ç»­è´¹ {{ serviceFee }}å…ƒ</text>
					</view>
				</view>

				<!-- æç°è¯´æ˜ -->
				<view class="tips-card">
					<text class="tips-title">ğŸ’¡ æç°è¯´æ˜</text>
					<view class="tips-list">
						<text class="tip-item">â€¢ å•ç¬”æç°é‡‘é¢ï¼š10-50,000å…ƒ</text>
						<text class="tip-item">â€¢ æ‰‹ç»­è´¹ï¼šæç°é‡‘é¢çš„0.6%ï¼Œæœ€ä½2å…ƒ</text>
						<text class="tip-item">â€¢ å®æ—¶åˆ°è´¦ï¼š2å°æ—¶å†…åˆ°è´¦</text>
						<text class="tip-item">â€¢ æ¯æ—¥é™é¢ï¼šå•æ—¥æœ€å¤šæç°100,000å…ƒ</text>
						<text class="tip-item">â€¢ å¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœï¼š400-123-4567</text>
					</view>
				</view>

				<!-- æäº¤æŒ‰é’® -->
				<view class="btn-submit" :class="{ disabled: !canSubmit }" @tap="confirmWithdraw">
					<text class="btn-submit-text">ç¡®è®¤æç°</text>
				</view>
			</view>
		</scroll-view>
	</view>
</template>

<script setup lang="uts">
import { ref, computed, onMounted } from 'vue'
// import { getWalletInfo, withdraw, getWithdrawConfig } from '@/services/wallet'

// å¯æç°ä½™é¢
const availableBalance = ref('12,580.00')

// æç°é‡‘é¢
const withdrawAmount = ref('')

// é€‰ä¸­çš„é“¶è¡Œå¡
const selectedBankCard = ref(1)

// é“¶è¡Œå¡åˆ—è¡¨
const bankCards = ref([
	{
		id: 1,
		bankName: 'ä¸­å›½å·¥å•†é“¶è¡Œ',
		cardNo: 'å°¾å· 8888'
	},
	{
		id: 2,
		bankName: 'ä¸­å›½å»ºè®¾é“¶è¡Œ',
		cardNo: 'å°¾å· 6666'
	}
])

// è®¡ç®—æ‰‹ç»­è´¹
const serviceFee = computed(() => {
	const amount = parseFloat(withdrawAmount.value) || 0
	const fee = amount * 0.006
	return Math.max(fee, 2).toFixed(2)
})

// è®¡ç®—å®é™…åˆ°è´¦é‡‘é¢
const actualAmount = computed(() => {
	const amount = parseFloat(withdrawAmount.value) || 0
	const fee = parseFloat(serviceFee.value)
	return Math.max(amount - fee, 0).toFixed(2)
})

// åˆ¤æ–­æ˜¯å¦å¯ä»¥æäº¤
const canSubmit = computed(() => {
	const amount = parseFloat(withdrawAmount.value)
	const available = parseFloat(availableBalance.value.replace(/,/g, ''))
	return amount >= 10 && amount <= 50000 && amount <= available && selectedBankCard.value > 0
})

// åŠ è½½é’±åŒ…ä¿¡æ¯
const loadWalletInfo = async () => {
	// Mock implementation
}

// åŠ è½½é“¶è¡Œå¡åˆ—è¡¨
const loadBankCards = async () => {
	// Mock implementation
}

// å…¨éƒ¨æç°
const withdrawAll = () => {
	withdrawAmount.value = availableBalance.value.replace(/,/g, '')
}

// é€‰æ‹©é“¶è¡Œå¡
const selectBankCard = (id: number) => {
	selectedBankCard.value = id
}

// æ·»åŠ é“¶è¡Œå¡
const addBankCard = () => {
	uni.showToast({
		title: 'æ·»åŠ é“¶è¡Œå¡åŠŸèƒ½å¼€å‘ä¸­',
		icon: 'none'
	})
}

// ç¡®è®¤æç°
const confirmWithdraw = async () => {
	if (!canSubmit.value) return

	const amount = parseFloat(withdrawAmount.value)
	const available = parseFloat(availableBalance.value.replace(/,/g, ''))

	if (amount < 10) {
		uni.showToast({
			title: 'æç°é‡‘é¢ä¸èƒ½å°‘äº10å…ƒ',
			icon: 'none'
		})
		return
	}

	if (amount > 50000) {
		uni.showToast({
			title: 'å•ç¬”æç°é‡‘é¢ä¸èƒ½è¶…è¿‡50,000å…ƒ',
			icon: 'none'
		})
		return
	}

	if (amount > available) {
		uni.showToast({
			title: 'æç°é‡‘é¢ä¸èƒ½å¤§äºå¯ç”¨ä½™é¢',
			icon: 'none'
		})
		return
	}

	uni.showModal({
		title: 'ç¡®è®¤æç°',
		content: `æç°é‡‘é¢ï¼šÂ¥${amount}\næ‰‹ç»­è´¹ï¼šÂ¥${serviceFee.value}\nå®é™…åˆ°è´¦ï¼šÂ¥${actualAmount.value}`,
		success: async (res) => {
			if (res.confirm) {
				try {
					uni.showLoading({ title: 'å¤„ç†ä¸­...' })
					
					// Mock withdraw
					setTimeout(() => {
						uni.hideLoading()
						uni.showToast({
							title: 'æç°ç”³è¯·å·²æäº¤',
							icon: 'success'
						})
						setTimeout(() => {
							uni.navigateBack()
						}, 1500)
					}, 1000)
					
				} catch (error) {
					uni.hideLoading()
					uni.showToast({
						title: 'æç°å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					})
				}
			}
		}
	})
}

// è¿”å›
const goBack = () => {
	uni.navigateBack()
}

// é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
onMounted(() => {
	loadWalletInfo()
	loadBankCards()
})
</script>

<style>
.page-container {
	display: flex;
	flex-direction: column;
	background-color: #f5f7fa;
	height: 100vh;
}

/* Header */
.header {
	height: 112rpx; /* 56px */
	background-color: #ffffff;
	display: flex;
	align-items: center;
	padding: 0 32rpx;
	justify-content: center;
	position: relative;
}

.header-left {
	position: absolute;
	left: 32rpx;
	display: flex;
	align-items: center;
	gap: 16rpx;
}

.header-title {
	font-size: 34rpx; /* 17px */
	font-weight: 600;
	color: #1f2329;
	font-family: 'Inter', sans-serif;
}

/* Content */
.content {
	flex: 1;
	height: 0;
}

.content-wrapper {
	padding: 32rpx;
	display: flex;
	flex-direction: column;
	gap: 32rpx; /* 16px */
}

.card {
	background-color: #ffffff;
	border-radius: 24rpx; /* 12px */
	padding: 32rpx; /* 16px */
	display: flex;
	flex-direction: column;
}

.card-title {
	font-size: 32rpx;
	font-weight: 600;
	color: #1f2329;
	margin-bottom: 24rpx;
}

.card-label {
	font-size: 28rpx;
	color: #999999;
	margin-bottom: 16rpx;
}

/* Balance Card */
.balance-value {
	font-size: 56rpx;
	font-weight: 700;
	color: #1f2329;
}

/* Amount Card */
.amount-input-box {
	display: flex;
	flex-direction: row;
	align-items: center;
	border-bottom: 2rpx solid #e5e5e5;
	padding-bottom: 24rpx;
	margin-bottom: 24rpx;
}

.currency-symbol {
	font-size: 48rpx;
	color: #1f2329;
	margin-right: 16rpx;
	font-weight: 600;
}

.amount-input {
	flex: 1;
	font-size: 56rpx;
	font-weight: 700;
	color: #1f2329;
	height: 80rpx;
}

.input-placeholder {
	color: #c8c9cc;
}

.amount-footer {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.fee-text {
	font-size: 28rpx;
	color: #999999;
}

.action-text {
	font-size: 28rpx;
	color: #0052d9;
}

/* Account Card */
.account-item {
	display: flex;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	padding: 24rpx 0;
	border-bottom: 2rpx solid #e5e5e5;
}

.account-info {
	display: flex;
	flex-direction: row;
	align-items: center;
	flex: 1;
}

.bank-icon-box {
	width: 80rpx;
	height: 80rpx;
	border-radius: 12rpx;
	background-color: #f5f5f5;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 24rpx;
}

.bank-detail {
	display: flex;
	flex-direction: column;
	gap: 8rpx;
}

.bank-name {
	font-size: 32rpx;
	color: #1f2329;
}

.bank-no {
	font-size: 24rpx;
	color: #999999;
}

.radio-box {
	width: 40rpx;
	height: 40rpx;
	border-radius: 50%;
	border: 4rpx solid #e5e5e5;
	display: flex;
	align-items: center;
	justify-content: center;
}

.radio-box.active {
	border-color: #0052d9;
}

.radio-inner {
	width: 24rpx;
	height: 24rpx;
	border-radius: 50%;
	background-color: #0052d9;
}

.add-card-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	padding-top: 24rpx;
}

.add-card-text {
	font-size: 32rpx;
	color: #0052d9;
}

/* Time Card */
.time-item {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.time-info {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 24rpx;
}

.time-detail {
	display: flex;
	flex-direction: column;
	gap: 8rpx;
}

.time-title {
	font-size: 32rpx;
	color: #1f2329;
}

.time-desc {
	font-size: 24rpx;
	color: #999999;
}

.fee-highlight {
	font-size: 32rpx;
	color: #ff9500;
}

/* Tips Card */
.tips-card {
	background-color: #fff7e6;
	border-radius: 16rpx;
	padding: 24rpx;
	display: flex;
	flex-direction: column;
	gap: 16rpx;
}

.tips-title {
	font-size: 28rpx;
	font-weight: 700;
	color: #ed6a0c;
}

.tips-list {
	display: flex;
	flex-direction: column;
	gap: 8rpx;
}

.tip-item {
	font-size: 26rpx;
	color: #646a73;
}

/* Submit Button */
.btn-submit {
	height: 96rpx;
	background-color: #0052d9;
	border-radius: 24rpx; /* 12px */
	display: flex;
	align-items: center;
	justify-content: center;
	margin-top: 16rpx;
}

.btn-submit.disabled {
	background-color: #c0c4cc;
}

.btn-submit-text {
	font-size: 32rpx;
	color: #ffffff;
	font-weight: 500;
}
</style>
