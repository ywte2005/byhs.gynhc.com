<template>
	<view class="page-container">
		<!-- Header -->
		<view class="header">
			<view class="user-info" @tap="toEdit">
				<view class="avatar-wrapper">
					<image class="avatar" :src="userInfo?.avatarUrl || '/static/logo.png'" mode="aspectFill" />
				</view>
				<view class="info-content">
					<text class="user-name">{{ userInfo?.nickName || 'ç‚¹å‡»ç™»å½•' }}</text>
					<text class="user-id" v-if="userInfo?.phone">ID: {{ userInfo?.phone }}</text>
				</view>
				<text class="arrow-right">></text>
			</view>

			<view class="stats-row">
				<view class="stat-item" @tap="toWallet">
					<text class="stat-num">{{ walletInfo.balance || '0.00' }}</text>
					<text class="stat-label">ä½™é¢</text>
				</view>
				<view class="stat-item">
					<text class="stat-num">0</text>
					<text class="stat-label">ç§¯åˆ†</text>
				</view>
				<view class="stat-item">
					<text class="stat-num">0</text>
					<text class="stat-label">ä¼˜æƒ åˆ¸</text>
				</view>
				<view class="stat-item">
					<text class="stat-num">0</text>
					<text class="stat-label">æ”¶è—</text>
				</view>
			</view>
		</view>

		<scroll-view class="content" scroll-y>
			<view class="content-wrapper">
				<!-- Orders -->
				<view class="card order-card">
					<view class="card-header" @tap="toOrder">
						<text class="card-title">æˆ‘çš„è®¢å•</text>
						<view class="more-box">
							<text class="more-text">å…¨éƒ¨è®¢å•</text>
							<text class="more-arrow">></text>
						</view>
					</view>
					<view class="grid-row">
						<view class="grid-item">
							<text class="grid-icon">ğŸ’³</text>
							<text class="grid-label">å¾…æ”¯ä»˜</text>
						</view>
						<view class="grid-item">
							<text class="grid-icon">ğŸ“¦</text>
							<text class="grid-label">å¾…å‘è´§</text>
						</view>
						<view class="grid-item">
							<text class="grid-icon">ğŸšš</text>
							<text class="grid-label">å¾…æ”¶è´§</text>
						</view>
						<view class="grid-item">
							<text class="grid-icon">ğŸ’¬</text>
							<text class="grid-label">å¾…è¯„ä»·</text>
						</view>
						<view class="grid-item">
							<text class="grid-icon">ğŸ§</text>
							<text class="grid-label">å”®å</text>
						</view>
					</view>
				</view>

				<!-- Functions -->
				<view class="card menu-card">
					<view class="menu-item" @tap="toWallet">
						<view class="menu-left">
							<text class="menu-icon">ğŸ’°</text>
							<text class="menu-label">æˆ‘çš„é’±åŒ…</text>
						</view>
						<text class="menu-arrow">></text>
					</view>
					<view class="divider"></view>
					<view class="menu-item" @tap="toPromo">
						<view class="menu-left">
							<text class="menu-icon">ğŸ</text>
							<text class="menu-label">æ¨å¹¿ä¸­å¿ƒ</text>
						</view>
						<text class="menu-arrow">></text>
					</view>
					<view class="divider"></view>
					<view class="menu-item" @tap="toMerchant">
						<view class="menu-left">
							<text class="menu-icon">ğŸª</text>
							<text class="menu-label">å•†æˆ·ä¸­å¿ƒ</text>
						</view>
						<text class="menu-arrow">></text>
					</view>
					<view class="divider"></view>
					<view class="menu-item" @tap="toAddress">
						<view class="menu-left">
							<text class="menu-icon">ğŸ“</text>
							<text class="menu-label">åœ°å€ç®¡ç†</text>
						</view>
						<text class="menu-arrow">></text>
					</view>
					<view class="divider"></view>
					<view class="menu-item" @tap="toSettings">
						<view class="menu-left">
							<text class="menu-icon">âš™ï¸</text>
							<text class="menu-label">è®¾ç½®</text>
						</view>
						<text class="menu-arrow">></text>
					</view>
				</view>
			</view>
		</scroll-view>

		<!-- Custom Tabbar -->
		<custom-tabbar></custom-tabbar>
	</view>
</template>

<script setup lang="ts">
import { useStore } from "@/.cool";
import CustomTabbar from "./components/tabbar.uvue";
import { onShow } from "@dcloudio/uni-app";
import { ref } from "vue";
import { getWalletInfo } from "@/services/wallet";

const { user } = useStore();
const userInfo = user.info;
const walletInfo = ref({ balance: '0.00' });

function toEdit() {
	if (!user.token) {
		uni.navigateTo({ url: '/pages/user/login' });
		return;
	}
	uni.navigateTo({ url: '/pages/user/edit' });
}

function toWallet() {
	uni.navigateTo({ url: '/pages/wallet/index' });
}

function toOrder() {
	uni.showToast({ title: 'è®¢å•åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' });
}

function toPromo() {
	uni.navigateTo({ url: '/pages/promo/index' });
}

function toMerchant() {
	uni.navigateTo({ url: '/pages/merchant/index' });
}

function toAddress() {
	uni.navigateTo({ url: '/pages/template/shop/address' });
}

function toSettings() {
	uni.navigateTo({ url: '/pages/set/index' });
}

onShow(() => {
	user.get();
	if (user.token) {
		getWalletInfo().then(res => {
			if (res.code === 0) {
				walletInfo.value = res.data;
			}
		}).catch(() => {});
	}
});
</script>

<style>
.page-container {
	display: flex;
	flex-direction: column;
	background-color: #f5f7fa;
	height: 100vh;
}

/* Header */
.my-header {
	background-color: #0052d9;
	padding: 48rpx 32rpx;
	padding-top: calc(48rpx + env(safe-area-inset-top));
	display: flex;
	flex-direction: column;
	gap: 48rpx;
}

.user-info {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 24rpx;
}

.avatar-wrapper {
	width: 120rpx;
	height: 120rpx;
	border-radius: 60rpx;
	background-color: #ffffff;
	border: 4rpx solid rgba(255, 255, 255, 0.3);
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
}

.avatar {
	width: 100%;
	height: 100%;
}

.info-content {
	flex: 1;
	display: flex;
	flex-direction: column;
	gap: 8rpx;
}

.user-name {
	font-size: 36rpx;
	font-weight: 600;
	color: #ffffff;
}

.user-id {
	font-size: 24rpx;
	color: rgba(255, 255, 255, 0.8);
}

.arrow-right {
	font-size: 32rpx;
	color: rgba(255, 255, 255, 0.6);
}

.stats-row {
	display: flex;
	flex-direction: row;
	justify-content: space-around;
}

.stat-item {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 8rpx;
}

.stat-num {
	font-size: 36rpx;
	font-weight: 700;
	color: #ffffff;
}

.stat-label {
	font-size: 24rpx;
	color: rgba(255, 255, 255, 0.8);
}

/* Content */
.content {
	flex: 1;
	height: 0;
	margin-top: -24rpx;
	border-top-left-radius: 24rpx;
	border-top-right-radius: 24rpx;
	background-color: #f5f7fa;
	overflow: hidden;
}

.content-wrapper {
	padding: 32rpx;
	padding-bottom: 120rpx; /* Tabbar height */
	display: flex;
	flex-direction: column;
	gap: 24rpx;
}

.card {
	background-color: #ffffff;
	border-radius: 24rpx;
	padding: 0 32rpx;
	display: flex;
	flex-direction: column;
}

/* Order Card */
.order-card {
	padding: 32rpx;
}

.card-header {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 32rpx;
}

.card-title {
	font-size: 32rpx;
	font-weight: 600;
	color: #1f2329;
}

.more-box {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 4rpx;
}

.more-text {
	font-size: 26rpx;
	color: #999999;
}

.more-arrow {
	font-size: 26rpx;
	color: #999999;
}

.grid-row {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
}

.grid-item {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 12rpx;
}

.grid-icon {
	font-size: 48rpx;
}

.grid-label {
	font-size: 24rpx;
	color: #646a73;
}

/* Menu Card */
.menu-card {
	padding: 0 32rpx;
}

.menu-item {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
	height: 112rpx;
}

.menu-left {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 24rpx;
}

.menu-icon {
	font-size: 40rpx;
}

.menu-label {
	font-size: 30rpx;
	color: #1f2329;
}

.menu-arrow {
	font-size: 30rpx;
	color: #c0c4cc;
}

.divider {
	height: 2rpx;
	background-color: #f0f0f0;
}
</style>
