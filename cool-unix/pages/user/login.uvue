<template>
	<view class="flex flex-col bg-white min-h-screen">
		<cl-topbar :show-back="true" background-color="#ffffff" safe-area-top :border="false"></cl-topbar>

		<view class="flex flex-col px-[64rpx] pt-[64rpx] pb-[64rpx]">
			<!-- Logo -->
			<view class="flex flex-col items-center justify-center gap-[24rpx] mb-[64rpx]">
				<view class="w-[144rpx] h-[144rpx] bg-[#0052d9] rounded-[32rpx] flex items-center justify-center">
					<text class="text-white text-[64rpx]">ğŸª</text>
				</view>
				<text class="text-[48rpx] font-semibold text-[#1f2329]">æ—ºé“ºé›†</text>
			</view>

			<!-- Form -->
			<view class="flex flex-col gap-[32rpx]">
				<!-- Phone -->
				<view class="flex flex-col gap-[16rpx]">
					<input
						class="h-[96rpx] bg-[#f5f7fa] rounded-[16rpx] px-[32rpx] text-[30rpx] text-[#1f2329]"
						type="number"
						v-model="form.phone"
						placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
						placeholder-class="text-[#c0c4cc]"
						maxlength="11"
					/>
				</view>

				<!-- Password -->
				<view class="flex flex-col gap-[16rpx]">
					<input
						class="h-[96rpx] bg-[#f5f7fa] rounded-[16rpx] px-[32rpx] text-[30rpx] text-[#1f2329]"
						type="password"
						v-model="form.password"
						placeholder="è¯·è¾“å…¥å¯†ç "
						placeholder-class="text-[#c0c4cc]"
					/>
				</view>

				<!-- Agreement -->
				<view class="flex flex-row items-center gap-[16rpx]" @tap="form.agree = !form.agree">
					<view class="w-[32rpx] h-[32rpx] border-[2rpx] border-[#c0c4cc] rounded-full flex items-center justify-center" :class="{ 'border-[#0052d9] bg-[#0052d9]': form.agree }">
						<view v-if="form.agree" class="w-[12rpx] h-[24rpx] border-b-[4rpx] border-r-[4rpx] border-white rotate-45 -translate-y-[2rpx]"></view>
					</view>
					<text class="text-[24rpx] text-[#86909c]">å·²é˜…è¯»å¹¶åŒæ„ã€Šç”¨æˆ·åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹</text>
				</view>

				<!-- Login Button -->
				<view class="h-[96rpx] bg-[#0052d9] rounded-[16rpx] flex items-center justify-center" @tap="toLogin">
					<text class="text-[32rpx] text-white font-medium">ç™»å½•</text>
				</view>

				<!-- Actions -->
				<view class="flex flex-row justify-center items-center gap-[24rpx] mt-[16rpx]">
					<text class="text-[28rpx] text-[#0052d9]" @tap="toRegister">æ³¨å†Œè´¦å·</text>
					<text class="text-[24rpx] text-[#e5e6eb]">|</text>
					<text class="text-[28rpx] text-[#0052d9]" @tap="toForget">å¿˜è®°å¯†ç </text>
				</view>

				<!-- Divider -->
				<view class="flex items-center justify-center h-[40rpx] mt-[48rpx]">
					<text class="text-[24rpx] text-[#c0c4cc]">å…¶ä»–ç™»å½•æ–¹å¼</text>
				</view>

				<!-- Wx Login -->
				<view class="h-[96rpx] bg-white border-[2rpx] border-[#e5e6eb] rounded-[16rpx] flex items-center justify-center" @tap="wxLogin">
					<text class="text-[30rpx] text-[#1f2329]">å¾®ä¿¡ä¸€é”®ç™»å½•</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script setup lang="ts">
import { ref } from "vue";
import { useStore, router } from "@/.cool";

const { user } = useStore();

const form = ref({
	phone: "",
	password: "",
	agree: false
});

async function toLogin() {
	if (!form.value.phone) {
		uni.showToast({
			title: "è¯·è¾“å…¥æ‰‹æœºå·",
			icon: "none"
		});
		return;
	}
	if (!form.value.password) {
		uni.showToast({
			title: "è¯·è¾“å…¥å¯†ç ",
			icon: "none"
		});
		return;
	}
	if (!form.value.agree) {
		uni.showToast({
			title: "è¯·é˜…è¯»å¹¶åŒæ„ç”¨æˆ·åè®®",
			icon: "none"
		});
		return;
	}

	uni.showLoading({
		title: "ç™»å½•ä¸­..."
	});

	try {
		await user.login(form.value);
		uni.hideLoading();
		// ç™»å½•æˆåŠŸåè·³è½¬åˆ°é¦–é¡µ
		router.push({ path: "/pages/index/home", isTab: true });
	} catch (err: any) {
		uni.hideLoading();
		uni.showToast({
			title: err.message|| "ç™»å½•å¤±è´¥",
			icon: "none"
		});
	}
}

function toRegister() {
	router.push("/pages/auth/register");
}

function toForget() {
	uni.showToast({
		title: "åŠŸèƒ½å¼€å‘ä¸­",
		icon: "none"
	});
}

function wxLogin() {
	uni.showToast({
		title: "å¾®ä¿¡ç™»å½•å¼€å‘ä¸­",
		icon: "none"
	});
}
</script>

<style>
</style>
