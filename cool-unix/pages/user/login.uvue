<template>
	<view class="flex flex-col bg-white min-h-screen">
		<cl-topbar :show-back="true" background-color="#ffffff" safe-area-top :border="false"></cl-topbar>

		<view class="flex flex-col px-[64rpx] pt-[64rpx] pb-[64rpx]">
			<!-- Logo -->
			<view class="flex flex-col items-center justify-center gap-[24rpx] mb-[64rpx]">
				<view class="w-[144rpx] h-[144rpx] bg-[#0052d9] rounded-[32rpx] flex items-center justify-center">
					<uni-icons type="bolt-filled" size="30" color="#ffffff"></uni-icons>
				</view>
				<text class="text-[48rpx] font-semibold text-[#1f2329]">旺铺集</text>
			</view>

			<!-- Form -->
			<view class="flex flex-col gap-[32rpx]">
				<!-- Phone -->
				<view class="flex flex-col gap-[16rpx]">
					<input
						class="h-[96rpx] bg-[#f5f7fa] rounded-[16rpx] px-[32rpx] text-[30rpx] text-[#1f2329]"
						type="number"
						v-model="form.phone"
						placeholder="请输入手机号"
						placeholder-class="text-[#c0c4cc]"
						maxlength="11"
					/>
				</view>

				<!-- Password -->
				<view class="flex flex-col gap-[16rpx]">
					<input
						class="h-[96rpx] bg-[#f5f7fa] rounded-[16rpx] px-[32rpx] text-[30rpx] text-[#1f2329]"
						type="password"
						v-model="form.password"
						placeholder="请输入密码"
						placeholder-class="text-[#c0c4cc]"
					/>
				</view>

				<!-- Agreement -->
				<view class="flex flex-row items-center gap-[16rpx]">
					<cl-checkbox v-model="form.agree">已阅读并同意《用户协议》和《隐私政策》</cl-checkbox>
				</view>

				<!-- Login Button -->
				<view class="h-[96rpx] bg-[#0052d9] rounded-[16rpx] flex items-center justify-center" @tap="toLogin">
					<text class="text-[32rpx] text-white font-medium">登录</text>
				</view>

				<!-- Actions -->
				<view class="flex flex-row justify-center items-center gap-[24rpx] mt-[16rpx]">
					<text class="text-[28rpx] text-[#0052d9]" @tap="toRegister">注册账号</text>
					<text class="text-[24rpx] text-[#e5e6eb]">|</text>
					<text class="text-[28rpx] text-[#0052d9]" @tap="toForget">忘记密码</text>
				</view>

				<!-- Divider -->
				<view class="flex items-center justify-center h-[40rpx] mt-[48rpx]">
					<text class="text-[24rpx] text-[#c0c4cc]">其他登录方式</text>
				</view>

				<!-- Wx Login -->
				<view class="h-[96rpx] bg-white border border-[#e5e6eb] rounded-[16rpx] flex items-center justify-center" @tap="wxLogin">
					<text class="text-[30rpx] text-[#1f2329]">微信一键登录</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script setup lang="ts">
import { ref } from "vue";
import { useStore, router } from "@/.cool";

const { user } = useStore();

const form = ref({
	phone: "",
	password: "",
	agree: false
});

async function toLogin() {
	if (!form.value.phone) {
		uni.showToast({
			title: "请输入手机号",
			icon: "none"
		});
		return;
	}
	if (!form.value.password) {
		uni.showToast({
			title: "请输入密码",
			icon: "none"
		});
		return;
	}
	if (!form.value.agree) {
		uni.showToast({
			title: "请阅读并同意用户协议",
			icon: "none"
		});
		return;
	}

	uni.showLoading({
		title: "登录中..."
	});

	try {
		await user.login(form.value);
		uni.hideLoading();
		// 登录成功后跳转到首页
		router.push({ path: "/pages/index/home", isTab: true });
	} catch (err: any) {
		uni.hideLoading();
		uni.showToast({
			title: err.message|| "登录失败",
			icon: "none"
		});
	}
}

function toRegister() {
	uni.navigateTo({ url: "/pages/user/register" });
}

function toForget() {
	uni.navigateTo({ url: "/pages/user/forgot" });
}

function wxLogin() {
	uni.showToast({
		title: "微信登录开发中",
		icon: "none"
	});
}
</script>

<style>
</style>
