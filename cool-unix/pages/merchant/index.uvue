<template>
	<view class="flex flex-col h-full bg-[#f5f5f5]">
		<!-- é¡¶éƒ¨å¯¼èˆª -->
		<view class="flex items-center justify-between px-4 py-3 bg-white">
			<view class="flex items-center" @click="goBack">
				<text class="text-6">â†</text>
				<text class="text-4 ml-2">å•†æˆ·ä¸­å¿ƒ</text>
			</view>
			<view @click="goToInfo">
				<text class="text-4 text-[#07c160]">è®¾ç½®</text>
			</view>
		</view>

		<!-- å†…å®¹åŒºåŸŸ -->
		<scroll-view class="flex-1" scroll-y>
			<!-- å•†æˆ·ä¿¡æ¯å¡ç‰‡ -->
			<view class="px-4 py-4">
				<view class="bg-gradient-to-r from-[#07c160] to-[#05a850] rounded-2 p-4 mb-3">
					<view class="flex items-center justify-between mb-4">
						<view class="flex items-center">
							<view class="w-16 h-16 rounded-full bg-white flex items-center justify-center mr-3">
								<text class="text-8">ğŸª</text>
							</view>
							<view>
								<text class="text-5 font-bold text-white">{{ merchantInfo.name }}</text>
								<text class="text-3.5 text-white mt-1">å•†æˆ·ç¼–å·ï¼š{{ merchantInfo.merchantNo }}</text>
							</view>
						</view>
					</view>

					<view class="flex items-center justify-between bg-white/20 rounded-2 p-3">
						<view class="flex-1 text-center">
							<text class="text-5 font-bold text-white">{{ merchantInfo.level }}</text>
							<text class="text-3 text-white mt-1">å•†æˆ·ç­‰çº§</text>
						</view>
						<view class="w-0.5 h-10 bg-white/30"></view>
						<view class="flex-1 text-center">
							<text class="text-5 font-bold text-white">{{ merchantInfo.credit }}</text>
							<text class="text-3 text-white mt-1">ä¿¡ç”¨åˆ†</text>
						</view>
						<view class="w-0.5 h-10 bg-white/30"></view>
						<view class="flex-1 text-center">
							<text class="text-5 font-bold text-white">{{ merchantInfo.orderCount }}</text>
							<text class="text-3 text-white mt-1">è®¢å•æ•°</text>
						</view>
					</view>
				</view>

				<!-- ä½™é¢å¡ç‰‡ -->
				<view class="bg-white rounded-2 p-4 mb-3">
					<text class="text-4 font-bold text-[#1f2329] mb-3">è´¦æˆ·ä½™é¢</text>
					
					<view class="flex items-center justify-between mb-3">
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">å¯ç”¨ä½™é¢</text>
							<text class="text-6 font-bold text-[#1f2329] mt-1">Â¥{{ merchantInfo.balance }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">å†»ç»“é‡‘é¢</text>
							<text class="text-5 font-bold text-[#ff9500] mt-1">Â¥{{ merchantInfo.frozenAmount }}</text>
						</view>
					</view>

					<view class="flex items-center justify-between mb-3">
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">ä¿è¯é‡‘</text>
							<text class="text-5 font-bold text-[#07c160] mt-1">Â¥{{ merchantInfo.deposit }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">äº’åŠ©ä½™é¢</text>
							<text class="text-5 font-bold text-[#5856d6] mt-1">Â¥{{ merchantInfo.mutualBalance }}</text>
						</view>
					</view>

					<view class="flex mt-3">
						<button 
							@click="goToRecharge"
							class="flex-1 bg-[#07c160] text-white rounded-full py-2.5 mr-2"
						>
							<text class="text-3.5">å……å€¼</text>
						</button>
						<button 
							@click="goToWithdraw"
							class="flex-1 bg-white border border-[#07c160] text-[#07c160] rounded-full py-2.5"
						>
							<text class="text-3.5">æç°</text>
						</button>
					</view>
				</view>

				<!-- å¿«æ·æ“ä½œ -->
				<view class="bg-white rounded-2 p-4 mb-3">
					<text class="text-4 font-bold text-[#1f2329] mb-3">å¿«æ·æ“ä½œ</text>
					
					<view class="flex flex-wrap">
						<view 
							v-for="(item, index) in quickActions" 
							:key="index"
							@click="handleQuickAction(item.action)"
							class="w-1/4 flex flex-col items-center mb-4"
						>
							<view class="w-12 h-12 rounded-full bg-[#f5f5f5] flex items-center justify-center mb-2">
								<text class="text-6">{{ item.icon }}</text>
							</view>
							<text class="text-3.5 text-[#1f2329]">{{ item.label }}</text>
						</view>
					</view>
				</view>

				<!-- ä»Šæ—¥æ•°æ® -->
				<view class="bg-white rounded-2 p-4 mb-3">
					<text class="text-4 font-bold text-[#1f2329] mb-3">ä»Šæ—¥æ•°æ®</text>
					
					<view class="flex items-center justify-between mb-3">
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">å‘èµ·ä»»åŠ¡</text>
							<text class="text-5 font-bold text-[#1f2329] mt-1">{{ todayData.publishedTasks }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">æ¥å•æ•°</text>
							<text class="text-5 font-bold text-[#1f2329] mt-1">{{ todayData.receivedTasks }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">å®Œæˆæ•°</text>
							<text class="text-5 font-bold text-[#1f2329] mt-1">{{ todayData.completedTasks }}</text>
						</view>
					</view>

					<view class="flex items-center justify-between">
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">æ”¶å…¥</text>
							<text class="text-5 font-bold text-[#07c160] mt-1">Â¥{{ todayData.income }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">æ”¯å‡º</text>
							<text class="text-5 font-bold text-[#ff3b30] mt-1">Â¥{{ todayData.expense }}</text>
						</view>
						<view class="flex-1">
							<text class="text-3.5 text-[#999]">ä½£é‡‘</text>
							<text class="text-5 font-bold text-[#ff9500] mt-1">Â¥{{ todayData.commission }}</text>
						</view>
					</view>
				</view>

				<!-- å¾…åŠäº‹é¡¹ -->
				<view class="bg-white rounded-2 p-4 mb-3">
					<text class="text-4 font-bold text-[#1f2329] mb-3">å¾…åŠäº‹é¡¹</text>
					
					<view 
						v-for="(item, index) in todoList" 
						:key="index"
						@click="handleTodo(item.action)"
						class="flex items-center justify-between py-3 border-b border-[#e5e5e5]"
					>
						<view class="flex items-center flex-1">
							<text class="text-5 mr-3">{{ item.icon }}</text>
							<view>
								<text class="text-4 text-[#1f2329]">{{ item.title }}</text>
								<text class="text-3.5 text-[#999] mt-1">{{ item.desc }}</text>
							</view>
						</view>
						<view class="flex items-center">
							<text class="text-5 font-bold text-[#ff3b30] mr-2">{{ item.count }}</text>
							<text class="text-4 text-[#999]">â†’</text>
						</view>
					</view>
				</view>

				<!-- å…¬å‘Šé€šçŸ¥ -->
				<view class="bg-white rounded-2 p-4">
					<text class="text-4 font-bold text-[#1f2329] mb-3">å…¬å‘Šé€šçŸ¥</text>
					
					<view 
						v-for="(item, index) in notices" 
						:key="index"
						class="flex items-start py-3 border-b border-[#e5e5e5]"
					>
						<text class="text-4 mr-2">ğŸ“¢</text>
						<view class="flex-1">
							<text class="text-4 text-[#1f2329]">{{ item.title }}</text>
							<text class="text-3.5 text-[#999] mt-1">{{ item.time }}</text>
						</view>
					</view>
				</view>
			</view>
		</scroll-view>
	</view>
</template>

<script setup lang="uts">
import { ref, onMounted } from 'vue'
import { getMerchantInfo } from '@/services/merchant'

// å•†æˆ·ä¿¡æ¯
const merchantInfo = ref({
	name: 'ç¤ºä¾‹å•†æˆ·',
	merchantNo: 'M202501290001',
	level: 'VIP',
	credit: 98,
	orderCount: 156,
	balance: '12,580.00',
	frozenAmount: '2,500.00',
	deposit: '5,000.00',
	mutualBalance: '8,320.00'
})

// ä»Šæ—¥æ•°æ®
const todayData = ref({
	publishedTasks: 5,
	receivedTasks: 12,
	completedTasks: 8,
	income: '1,250.00',
	expense: '850.00',
	commission: '320.00'
})

// å¿«æ·æ“ä½œ
const quickActions = [
	{ icon: 'ğŸ“', label: 'å‘èµ·ä»»åŠ¡', action: 'createTask' },
	{ icon: 'ğŸ“‹', label: 'ä»»åŠ¡å¤§å…', action: 'taskList' },
	{ icon: 'ğŸ’°', label: 'æˆ‘çš„é’±åŒ…', action: 'wallet' },
	{ icon: 'ğŸ“Š', label: 'æ•°æ®ç»Ÿè®¡', action: 'statistics' },
	{ icon: 'ğŸ‘¥', label: 'æˆ‘çš„å›¢é˜Ÿ', action: 'team' },
	{ icon: 'ğŸ', label: 'æ¨å¹¿ä¸­å¿ƒ', action: 'promo' },
	{ icon: 'ğŸ’¬', label: 'æ¶ˆæ¯ä¸­å¿ƒ', action: 'message' },
	{ icon: 'âš™ï¸', label: 'è®¾ç½®', action: 'settings' }
]

// å¾…åŠäº‹é¡¹
const todoList = ref([
	{ icon: 'â°', title: 'å¾…æ¥å•ä»»åŠ¡', desc: 'æœ‰æ–°çš„ä»»åŠ¡ç­‰å¾…æ¥å•', count: 8, action: 'pendingTasks' },
	{ icon: 'ğŸ“¸', title: 'å¾…ä¸Šä¼ å‡­è¯', desc: 'æœ‰ä»»åŠ¡éœ€è¦ä¸Šä¼ å‡­è¯', count: 3, action: 'uploadProof' },
	{ icon: 'âœ…', title: 'å¾…ç¡®è®¤å®Œæˆ', desc: 'æœ‰ä»»åŠ¡ç­‰å¾…ç¡®è®¤', count: 2, action: 'confirmTasks' }
])

// å…¬å‘Šé€šçŸ¥
const notices = ref([
	{ title: 'å¹³å°å‡çº§é€šçŸ¥ï¼šç³»ç»Ÿå°†äºä»Šæ™š22:00-24:00è¿›è¡Œç»´æŠ¤', time: '2å°æ—¶å‰' },
	{ title: 'æ–°åŠŸèƒ½ä¸Šçº¿ï¼šæ”¯æŒæ‰¹é‡å‘èµ·ä»»åŠ¡', time: '1å¤©å‰' },
	{ title: 'æ˜¥èŠ‚æ´»åŠ¨ï¼šå®Œæˆä»»åŠ¡é€çº¢åŒ…', time: '2å¤©å‰' }
])

// åŠ è½½å•†æˆ·ä¿¡æ¯
const loadMerchantInfo = async () => {
	try {
		const res = await getMerchantInfo()
		if (res.code === 0) {
			merchantInfo.value = res.data
		}
	} catch (error) {
		console.log('åŠ è½½å•†æˆ·ä¿¡æ¯å¤±è´¥', error)
	}
}

// åŠ è½½ä»Šæ—¥æ•°æ®
const loadTodayData = async () => {
	try {
		// TODO: å®ç°è·å–ä»Šæ—¥æ•°æ®æ¥å£
		const res = { code: 0, data: {} } as any
		if (res.code === 0) {
			todayData.value = res.data
		}
	} catch (error) {
		console.log('åŠ è½½ä»Šæ—¥æ•°æ®å¤±è´¥', error)
	}
}

// å¤„ç†å¿«æ·æ“ä½œ
const handleQuickAction = (action: string) => {
	const routes = {
		createTask: '/pages/task/create',
		taskList: '/pages/task/index',
		wallet: '/pages/wallet/index',
		statistics: '/pages/merchant/statistics',
		team: '/pages/promo/team',
		promo: '/pages/promo/index',
		message: '/pages/message/index',
		settings: '/pages/merchant/info'
	}
	
	const url = routes[action]
	if (url) {
		uni.navigateTo({ url })
	}
}

// å¤„ç†å¾…åŠäº‹é¡¹
const handleTodo = (action: string) => {
	const routes = {
		pendingTasks: '/pages/task/subtask/list',
		uploadProof: '/pages/task/subtask/my',
		confirmTasks: '/pages/task/my-tasks'
	}
	
	const url = routes[action]
	if (url) {
		uni.navigateTo({ url })
	}
}

// å……å€¼
const goToRecharge = () => {
	uni.navigateTo({
		url: '/pages/wallet/recharge'
	})
}

// æç°
const goToWithdraw = () => {
	uni.navigateTo({
		url: '/pages/wallet/withdraw'
	})
}

// è¿›å…¥å•†æˆ·ä¿¡æ¯
const goToInfo = () => {
	uni.navigateTo({
		url: '/pages/merchant/info'
	})
}

// è¿”å›
const goBack = () => {
	uni.navigateBack()
}

// é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
onMounted(() => {
	loadMerchantInfo()
	loadTodayData()
})
</script>
