<template>
	<view class="page-container">
		<!-- Header -->
		<view class="header">
			<view class="header-left" @click="goBack">
				<text class="back-icon">â†</text>
				<text class="header-title">é‚€è¯·å¥½å‹</text>
			</view>
		</view>

		<scroll-view class="content" scroll-y>
			<view class="content-wrapper">
				<!-- æµ·æŠ¥/é‚€è¯·ç å¡ç‰‡ -->
				<view class="card poster-card">
					<view class="poster-content">
						<text class="invite-label">æˆ‘çš„é‚€è¯·ç </text>
						<text class="invite-code">{{ inviteCode }}</text>
						<view class="qr-placeholder">
							<text class="qr-icon">ğŸ“·</text>
							<text class="qr-text">é‚€è¯·äºŒç»´ç </text>
						</view>
					</view>
					
					<view class="btn-share" @tap="copyCode">
						<text class="btn-share-text">å¤åˆ¶é‚€è¯·ç </text>
					</view>
				</view>

				<!-- ç»‘å®šä¸Šçº§ -->
				<view class="card bind-card">
					<text class="card-title">ç»‘å®šä¸Šçº§</text>
					<view class="input-wrapper">
						<input 
							class="input" 
							v-model="parentCode" 
							placeholder="è¯·è¾“å…¥ä¸Šçº§é‚€è¯·ç " 
							placeholder-class="input-placeholder"
						/>
					</view>
					<view 
						class="btn-bind" 
						:class="{ 'disabled': parentCode.length == 0 }"
						@tap="bindParent"
					>
						<text class="btn-bind-text">ç¡®è®¤ç»‘å®š</text>
					</view>
				</view>

				<!-- é‚€è¯·è¯´æ˜ -->
				<view class="card tips-card">
					<text class="card-title">é‚€è¯·è¯´æ˜</text>
					<view class="tips-list">
						<text class="tips-item">1. åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™å¥½å‹</text>
						<text class="tips-item">2. å¥½å‹æ³¨å†Œåè¾“å…¥æ‚¨çš„é‚€è¯·ç ç»‘å®š</text>
						<text class="tips-item">3. å¥½å‹äº§ç”Ÿä¸šç»©æ‚¨å¯è·å¾—ç›¸åº”å¥–åŠ±</text>
						<text class="tips-item">4. ç»‘å®šåä¸å¯æ›´æ”¹ï¼Œè¯·è°¨æ…æ“ä½œ</text>
					</view>
				</view>
			</view>
		</scroll-view>
	</view>
</template>

<script lang="uts">
	// import { getMyInviteCode, bindRelation } from "@/services/promo";

	export default {
		data() {
			return {
				inviteCode: '888888',
				parentCode: ''
			};
		},
		onShow() {
			this.loadInviteCode();
		},
		methods: {
			goBack() {
				uni.navigateBack();
			},
			loadInviteCode() {
				// Mock implementation
				// getMyInviteCode()
				// 	.then((res : { invite_code : string }) => {
				// 		this.inviteCode = res.invite_code;
				// 	})
				// 	.catch(() => { });
			},
			copyCode() {
				uni.setClipboardData({
					data: this.inviteCode,
					success: () => {
						uni.showToast({ title: 'å¤åˆ¶æˆåŠŸ', icon: 'success' });
					}
				});
			},
			bindParent() {
				if (this.parentCode.length == 0) {
					uni.showToast({ title: 'è¯·è¾“å…¥é‚€è¯·ç ', icon: 'none' });
					return;
				}

				uni.showModal({
					title: 'ç¡®è®¤ç»‘å®š',
					content: 'ç»‘å®šåä¸å¯æ›´æ”¹ï¼Œç¡®å®šç»‘å®šå—ï¼Ÿ',
					success: (res) => {
						if (res.confirm) {
							this.doBind();
						}
					}
				});
			},
			doBind() {
				uni.showLoading({ title: 'ç»‘å®šä¸­...' });
				// Mock
				setTimeout(() => {
					uni.hideLoading();
					uni.showToast({ title: 'ç»‘å®šæˆåŠŸ', icon: 'success' });
					this.parentCode = '';
				}, 1000);
				
				// bindRelation(this.parentCode)
				// 	.then(() => {
				// 		uni.hideLoading();
				// 		uni.showToast({ title: 'ç»‘å®šæˆåŠŸ', icon: 'success' });
				// 		this.parentCode = '';
				// 	})
				// 	.catch((err : any) => {
				// 		uni.hideLoading();
				// 		uni.showToast({ title: err.message ?? 'ç»‘å®šå¤±è´¥', icon: 'none' });
				// 	});
			}
		}
	};
</script>

<style>
.page-container {
	display: flex;
	flex-direction: column;
	background-color: #f5f7fa;
	height: 100vh;
}

/* Header */
.header {
	height: 112rpx; /* 56px */
	background-color: #ffffff;
	display: flex;
	align-items: center;
	padding: 0 32rpx;
	justify-content: center;
	position: relative;
}

.header-left {
	position: absolute;
	left: 32rpx;
	display: flex;
	align-items: center;
	gap: 16rpx;
}

.back-icon {
	font-size: 48rpx;
	color: #1f2329;
}

.header-title {
	font-size: 34rpx; /* 17px */
	font-weight: 600;
	color: #1f2329;
	font-family: 'Inter', sans-serif;
}

/* Content */
.content {
	flex: 1;
	height: 0;
}

.content-wrapper {
	padding: 32rpx;
	display: flex;
	flex-direction: column;
	gap: 32rpx;
}

.card {
	background-color: #ffffff;
	border-radius: 24rpx; /* 12px */
	padding: 32rpx;
	display: flex;
	flex-direction: column;
}

/* Poster Card */
.poster-card {
	align-items: center;
	gap: 32rpx;
}

.poster-content {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 24rpx;
	width: 100%;
}

.invite-label {
	font-size: 28rpx;
	color: #646a73;
}

.invite-code {
	font-size: 64rpx;
	font-weight: 700;
	color: #1f2329;
	letter-spacing: 4rpx;
}

.qr-placeholder {
	width: 300rpx;
	height: 300rpx;
	background-color: #f5f7fa;
	border-radius: 16rpx;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: 16rpx;
}

.qr-icon {
	font-size: 64rpx;
}

.qr-text {
	font-size: 24rpx;
	color: #9aa0a6;
}

.btn-share {
	width: 100%;
	height: 96rpx; /* 48px */
	background-color: #0052d9;
	border-radius: 16rpx; /* 8px */
	display: flex;
	align-items: center;
	justify-content: center;
}

.btn-share-text {
	font-size: 32rpx;
	color: #ffffff;
	font-weight: 500;
}

/* Bind Card */
.bind-card {
	gap: 24rpx;
}

.card-title {
	font-size: 32rpx;
	font-weight: 600;
	color: #1f2329;
}

.input-wrapper {
	height: 96rpx;
	background-color: #f5f7fa;
	border-radius: 16rpx;
	display: flex;
	align-items: center;
	padding: 0 24rpx;
}

.input {
	flex: 1;
	font-size: 28rpx;
	color: #1f2329;
}

.input-placeholder {
	color: #c0c4cc;
}

.btn-bind {
	height: 88rpx;
	background-color: #0052d9;
	border-radius: 16rpx;
	display: flex;
	align-items: center;
	justify-content: center;
}

.btn-bind.disabled {
	background-color: #c0c4cc;
}

.btn-bind-text {
	font-size: 30rpx;
	color: #ffffff;
	font-weight: 500;
}

/* Tips Card */
.tips-card {
	gap: 24rpx;
}

.tips-list {
	display: flex;
	flex-direction: column;
	gap: 16rpx;
}

.tips-item {
	font-size: 26rpx;
	color: #646a73;
	line-height: 1.5;
}
</style>
