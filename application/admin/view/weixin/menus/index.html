<link href="__CDN__/assets/addons/weixin/css/menu.css?v={$site['version']}" rel="stylesheet"/>

<div class="panel panel-default panel-intro">
    {:build_heading()}
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div class="weixin-menu-setting clearfix">
                        <div class="mobile-menu-preview">
                            <div class="mobile-head-title">
                                {$site.name|htmlentities}
                                {if $menusSync == 1}
                                <span style="font-size: 10px;color: #44b549;position: absolute;padding: 2px 0 0 3px">[已发布]</span>
                                {else}
                                <span style="font-size: 10px;color: #f60;position: absolute;padding: 2px 0 0 3px">[未发布]</span>
                                {/if}
                            </div>
                            <div class="time-wrapper" style="margin-bottom: 10px;text-align: center;"><span style="display: inline-block;color: #f5f5f5;background: rgba(0,0,0,.3);padding: 3px 8px;border-radius: 3px;font-size: 12px;margin-top:20px;" class="time">{:date('H:i')}</span></div>
                            <ul class="menu-list" id="menu-list"></ul>
                        </div>
                        <div class="weixin-body">
                            <div class="weixin-content" style="display:none">
                                <div class="item-info">
                                    <form id="form-item" class="form-item" data-value="">
                                        <div class="item-head">
                                            <h4 id="current-item-name">编辑菜单</h4>
                                            <div class="item-delete"><a href="javascript:;" id="item_delete">删除菜单</a></div>
                                        </div>
                                        <div style="margin-top: 20px;" id="item-body">

                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="no-weixin-content">
                                点击左侧菜单进行编辑操作，<a href="javascript:;" id="getMenu">点击这里可以拉取公众号菜单</a>
                            </div>
                        </div>
                    </div>

                    <div class="text-center" style="position:relative;">
                        <div class="text-danger" style="width:317px;position:absolute;left:0;top:0;">
                            <i class="fa fa-lightbulb-o"></i> <small>可直接拖动菜单排序</small>
                        </div>
                        <div>
                            <a href="javascript:;" id="menuSave" class="btn btn-info">保存</a>
                            <a href="javascript:;" id="menuSaveSyn" class="btn btn-danger">保存并发布</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script type="text/html" id="menutpl">
    <%for(var i=0; i< menus.length; i++){%>
    <%var first=menus[i];%>
    <li id="menu-<%=i%>" class="menu-item" data-type="<%=first['type']%>" data-key="<%=first['key']%>" data-name="<%=first['name']%>" data-url="<%=first['url']%>" data-appid="<%=first['appid']%>" data-pagepath="<%=first['pagepath']%>">
        <a href="javascript:;" class="menu-link">
            <i class="icon-menu-dot"></i> <i class="weixin-icon sort-gray"></i> <span class="title"><%=first['name']%></span>
        </a>
        <div class="sub-menu-box" style="display:none;">
            <ul class="sub-menu-list">
                <%if(typeof first['sub_button']!='undefined'){%>
                <%for(var j=0; j< first['sub_button'].length; j++){%>
                <%var second=first['sub_button'][j];%>
                <li id="sub-menu-<%=j%>" class="sub-menu-item" data-type="<%=second['type']%>" data-key="<%=second['key']%>" data-name="<%=second['name']%>" data-url="<%=second['url']%>" data-appid="<%=second['appid']%>" data-pagepath="<%=second['pagepath']%>"><a href="javascript:;"> <i class="weixin-icon sort-gray"></i><span class="sub-title"><%=second['name']%></span></a></li>
                <%}%>
                <%}%>
                <li class="add-sub-item <%if(typeof first['sub_button']!='undefined' && first['sub_button'].length>=5){%>hidden<%}%>"><a href="javascript:;" title="添加子菜单"><span class=" "><i class="weixin-icon add-gray"></i></span></a></li>
            </ul>
            <i class="arrow arrow-out"></i> <i class="arrow arrow-in"></i>
        </div>
    </li>
    <%}%>
    <li class="add-item extra" id="add-item">
        <a href="javascript:;" class="menu-link" title="添加菜单"><i class="weixin-icon add-gray"></i></a>
    </li>
</script>

<script type="text/html" id="itemtpl">
    <dl>
        <dt id="current-item-option"><span class="is-sub-item <%=first?'hidden':''%>">子</span>菜单标题：</dt>
        <dd>
            <div class="input-box"><input id="item_title" data-rule="required" name="name" type="text" value="<%=name%>"></div>
        </dd>
    </dl>
    <%if(!hasChild){%>
    <dl class="is-item">
        <dt id="current-item-type"><span class="is-sub-item <%=first?'hidden':''%>">子</span>菜单内容：</dt>
        <dd>
            <%for(var i=0;i< typeList.length; i++){%>
            <input id="type<%=i%>" type="radio" style="vertical-align:unset" name="type" value="<%=typeList[i]['name']%>" <%=typeList[i]['name']==type?'checked':''%> /><label for="type<%=i%>"><span class="lbl_content"><%=typeList[i]['title']%></span></label>
            <%}%>
        </dd>
    </dl>
    <div id="menu-content" class="is-item">
        <%if(type=='view'){%>
        <div class="viewbox is-view">
            <dl>
                <dt>跳转地址：</dt>
                <dd>
                    <div class="input-box"><input type="text" data-rule="required;url" name="url" value="<%=url%>"></div>
                </dd>
            </dl>
            <p class="menu-content-tips">点击该<span class="is-sub-item <%=first?'hidden':''%>">子</span>菜单会跳到该链接</p>
        </div>
        <%}%>
        <%if(type!='view'&&type!='miniprogram'){%>
        <div class="viewbox is-miniprogram">
            <dl>
                <dt>关键字：</dt>
                <dd>
                    <div class="input-box">
                        <input type="text" name="key" id="key" data-rule="required" value="<%=key%>" placeholder="请选择关键词回复" >
                    </div>
                </dd>
            </dl>
            <p class="menu-content-tips">点击该<span class="is-sub-item <%=first?'':'hidden'%>">子</span>菜单会触发关键字回复</p>
        </div>
        <%}%>
        <%if(type=='miniprogram'){%>
        <div class="viewbox is-miniprogram">
            <dl>
                <dt>小程序应用ID：</dt>
                <dd>
                    <div class="input-box"><input type="text" data-rule="required" id="appid" name="appid" placeholder="在小程序后台获取" value="<%=appid%>"></div>
                </dd>
            </dl>
            <dl>
                <dt>小程序页面路径：</dt>
                <dd>
                    <div class="input-box"><input type="text" data-rule="required" id="pagepath" name="pagepath" placeholder="小程序页面路径" value="<%=pagepath%>"></div>
                </dd>
            </dl>
            <dl>
                <dt>备用网页链接：</dt>
                <dd>
                    <div class="input-box"><input type="text" data-rule="required" name="url" placeholder="页面地址，当不支持小程序时会跳转此页面" value="<%=url%>"></div>
                </dd>
            </dl>
            <p class="menu-content-tips">点击该<span class="is-sub-item <%=first?'':'hidden'%>">子</span>菜单会跳到小程序，请确保已关联小程序，否则会同步失败</p>
        </div>
        <%}%>
    </div>
    <%}%>
</script>

<script type="text/javascript">
    var menus = {:json_encode($menus, JSON_UNESCAPED_UNICODE)};
    var responselist = '';
</script>
