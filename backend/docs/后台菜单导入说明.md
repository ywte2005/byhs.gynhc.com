# 后台管理菜单导入说明

**导入时间**: 2025-01-22  
**导入状态**: ✅ 已完成

---

## 一、菜单结构概览

### 1.1 已导入的菜单

系统已成功导入商户互助平台的后台管理菜单，菜单ID范围：**199-225**

**菜单层级结构**:
```
├── 商户管理 (199)
│   ├── 商户列表 (200)
│   │   ├── 查看 (220)
│   │   ├── 添加 (221)
│   │   ├── 编辑 (222)
│   │   ├── 删除 (223)
│   │   └── 详情 (224)
│   └── 商户审核 (225)
│
├── 任务管理 (201)
│   ├── 主任务列表 (202)
│   └── 子任务列表 (203)
│
├── 钱包管理 (204)
│   ├── 用户钱包 (205)
│   ├── 流水查询 (206)
│   ├── 提现审核 (207)
│   └── 充值订单 (219)
│
├── 推广管理 (208)
│   ├── 等级配置 (209)
│   ├── 推广关系 (210)
│   ├── 佣金记录 (211)
│   └── 分红管理 (212)
│
├── 配置中心 (213)
│   ├── 奖励规则 (214)
│   ├── 分润规则 (215)
│   └── 分红配置 (216)
│
└── 数据中心 (217)
    └── 数据仪表盘 (218)
```

---

## 二、菜单统计

### 2.1 数量统计

| 类型 | 数量 | 说明 |
|------|------|------|
| 一级菜单 | 6个 | 商户、任务、钱包、推广、配置、数据 |
| 二级菜单 | 15个 | 各功能模块的子菜单 |
| 操作权限 | 6个 | 查看、添加、编辑、删除、详情等 |
| **总计** | **27个** | 已导入菜单项 |

### 2.2 菜单类型

| 类型 | 数量 | ismenu值 |
|------|------|----------|
| 显示菜单 | 22个 | 1 |
| 操作权限 | 5个 | 0 |

---

## 三、已实现的功能模块

### 3.1 商户管理 ✅
- ✅ 商户列表（增删改查）
- ✅ 商户详情查看
- ✅ 商户审核（待补充操作权限）

### 3.2 任务管理 ✅
- ✅ 主任务列表（待补充操作权限）
- ✅ 子任务列表（待补充操作权限）

### 3.3 钱包管理 ✅
- ✅ 用户钱包（待补充操作权限）
- ✅ 流水查询（待补充操作权限）
- ✅ 提现审核（待补充操作权限）
- ✅ 充值订单（待补充操作权限）

### 3.4 推广管理 ✅
- ✅ 等级配置（待补充操作权限）
- ✅ 推广关系（待补充操作权限）
- ✅ 佣金记录（待补充操作权限）
- ✅ 分红管理（待补充操作权限）

### 3.5 配置中心 ✅
- ✅ 奖励规则（待补充操作权限）
- ✅ 分润规则（待补充操作权限）
- ✅ 分红配置（待补充操作权限）

### 3.6 数据中心 ✅
- ✅ 数据仪表盘（待补充操作权限）

---

## 四、待补充的操作权限

### 4.1 需要补充的权限项

以下菜单需要补充操作权限（index/add/edit/del等）：

**商户审核 (225)**
- merchant/audit/index (查看)
- merchant/audit/approve (审核通过)
- merchant/audit/reject (审核拒绝)

**主任务列表 (202)**
- task/mutualtask/index (查看)
- task/mutualtask/add (添加)
- task/mutualtask/edit (编辑)
- task/mutualtask/del (删除)
- task/mutualtask/detail (详情)
- task/mutualtask/approve (审核通过)
- task/mutualtask/reject (审核拒绝)
- task/mutualtask/dispatch (派发任务)

**子任务列表 (203)**
- task/subtask/index (查看)
- task/subtask/edit (编辑)
- task/subtask/complete (完成)
- task/subtask/fail (失败)

**用户钱包 (205)**
- wallet/wallet/index (查看)
- wallet/wallet/edit (编辑)

**流水查询 (206)**
- wallet/log/index (查看)

**充值订单 (219)**
- wallet/recharge/index (查看)
- wallet/recharge/complete (补单)

**提现审核 (207)**
- wallet/withdraw/index (查看)
- wallet/withdraw/approve (审核通过)
- wallet/withdraw/reject (审核拒绝)

**等级配置 (209)**
- promo/level/index (查看)
- promo/level/add (添加)
- promo/level/edit (编辑)
- promo/level/del (删除)

**推广关系 (210)**
- promo/relation/index (查看)
- promo/relation/edit (编辑)

**佣金记录 (211)**
- promo/commission/index (查看)

**分红管理 (212)**
- promo/bonus/index (查看)
- promo/bonus/settle (结算)

**业绩统计** (需新增二级菜单)
- promo/performance (业绩统计)
- promo/performance/index (查看)

**奖励规则 (214)**
- config/reward/index (查看)
- config/reward/edit (编辑)

**分润规则 (215)**
- config/profit/index (查看)
- config/profit/edit (编辑)

**分红配置 (216)**
- config/bonusconfig/index (查看)
- config/bonusconfig/edit (编辑)

**数据仪表盘 (218)**
- byhs/dashboard/index (查看)

---

## 五、手动补充操作权限

### 5.1 补充方式

可以通过以下方式补充操作权限：

**方式1: 后台管理界面**
1. 登录后台管理系统
2. 进入 `权限管理` → `菜单规则`
3. 找到对应的二级菜单
4. 点击 `添加` 按钮
5. 填写权限信息（name、title、ismenu=0）

**方式2: SQL批量导入**
```sql
-- 示例：为商户审核添加操作权限
INSERT INTO `fa_auth_rule` (`type`, `pid`, `name`, `title`, `ismenu`, `createtime`, `updatetime`, `weigh`, `status`) VALUES
('file', 225, 'merchant/audit/index', '查看', 0, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), 0, 'normal'),
('file', 225, 'merchant/audit/approve', '审核通过', 0, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), 0, 'normal'),
('file', 225, 'merchant/audit/reject', '审核拒绝', 0, UNIX_TIMESTAMP(), UNIX_TIMESTAMP(), 0, 'normal');
```

### 5.2 批量补充SQL

已生成批量补充SQL脚本：
- `/tmp/supplement_admin_menu_v2.sql`

**注意**: 由于部分菜单已存在操作权限，执行时可能会有重复键冲突，这是正常现象。

---

## 六、权限分配

### 6.1 管理员组权限

导入菜单后，需要为管理员组分配权限：

1. 进入 `权限管理` → `角色组`
2. 编辑 `超级管理员` 或其他角色组
3. 勾选新导入的菜单权限
4. 保存

### 6.2 权限规则ID

新导入的菜单ID范围：**199-225**

在分配权限时，需要将这些ID添加到对应角色组的 `rules` 字段中。

---

## 七、验证菜单

### 7.1 验证方式

**SQL查询验证**:
```sql
-- 查看所有已导入的菜单
SELECT id, pid, name, title, ismenu 
FROM fa_auth_rule 
WHERE id >= 199 
ORDER BY pid, id;

-- 统计菜单数量
SELECT 
    COUNT(*) as total,
    COUNT(CASE WHEN ismenu=1 THEN 1 END) as menu_count,
    COUNT(CASE WHEN ismenu=0 THEN 1 END) as action_count
FROM fa_auth_rule 
WHERE id >= 199;
```

**后台界面验证**:
1. 登录后台管理系统
2. 查看左侧菜单栏
3. 确认新菜单是否显示

---

## 八、注意事项

### 8.1 已知问题

1. ✅ 商户列表已有基本操作权限（查看、添加、编辑、删除、详情）
2. ⚠️ 其他二级菜单的操作权限需要手动补充
3. ⚠️ 业绩统计菜单需要新增（promo/performance）

### 8.2 建议

1. **优先补充高频使用的操作权限**：
   - 任务审核（approve/reject）
   - 提现审核（approve/reject）
   - 商户审核（approve/reject）

2. **后续优化**：
   - 补充所有二级菜单的操作权限
   - 新增业绩统计二级菜单
   - 优化菜单图标和排序

3. **权限测试**：
   - 创建测试管理员账号
   - 分配不同权限组
   - 验证权限控制是否生效

---

## 九、相关文件

### 9.1 SQL脚本

- `/tmp/import_admin_menu.sql` - 初始菜单导入脚本（ID冲突）
- `/tmp/import_admin_menu_v2.sql` - 调整后的菜单脚本（ID冲突）
- `/tmp/supplement_admin_menu_v2.sql` - 补充操作权限脚本（部分重复）

### 9.2 控制器文件

已实现的后台控制器：
- `/application/admin/controller/merchant/Merchant.php`
- `/application/admin/controller/merchant/Audit.php`
- `/application/admin/controller/task/Mutualtask.php`
- `/application/admin/controller/task/Subtask.php`
- `/application/admin/controller/wallet/Wallet.php`
- `/application/admin/controller/wallet/Log.php`
- `/application/admin/controller/wallet/Recharge.php`
- `/application/admin/controller/wallet/Withdraw.php`
- `/application/admin/controller/promo/Level.php`
- `/application/admin/controller/promo/Relation.php`
- `/application/admin/controller/promo/Commission.php`
- `/application/admin/controller/promo/Performance.php`
- `/application/admin/controller/promo/Bonus.php`
- `/application/admin/controller/config/Reward.php`
- `/application/admin/controller/config/Profit.php`
- `/application/admin/controller/config/Bonusconfig.php`

---

## 十、总结

### 10.1 导入状态

✅ **基础菜单结构已完成导入**

- 6个一级菜单
- 15个二级菜单
- 部分操作权限（商户列表）

### 10.2 下一步工作

1. ⚠️ 补充所有二级菜单的操作权限（约40个）
2. ⚠️ 新增业绩统计二级菜单
3. ⚠️ 为管理员组分配新菜单权限
4. ⚠️ 测试菜单显示和权限控制

---

**文档生成时间**: 2025-01-22  
**维护者**: 开发团队
